rm: cannot remove '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/result/*': No such file or directory
Executing test compatibility/test.sh
Removing network compatibility_default
Network compatibility_default not found.
Creating network "compatibility_default" with the default driver
Pulling datanode (apache/ozone-runner:20230503-1)...
20230503-1: Pulling from apache/ozone-runner
Digest: sha256:9c224951bb5655c8b5a0c58a72478a17dc594a75a5e4acb89c93bf0885c3fe73
Status: Downloaded newer image for apache/ozone-runner:20230503-1
Creating compatibility_s3g_1 ... 
Creating compatibility_scm_1 ... 
Creating compatibility_recon_1 ... 
Creating compatibility_om_1    ... 
Creating compatibility_datanode_1 ... 
Creating compatibility_scm_1      ... done
Creating compatibility_recon_1    ... done
Creating compatibility_s3g_1      ... done
Creating compatibility_datanode_1 ... done
Creating compatibility_om_1       ... done
WARNING: HADOOP_OPTS has been deprecated by OZONE_OPTS.
SECONDS: 35
com.google.protobuf.ServiceException: java.net.ConnectException: Call From 981b2d535b01/172.18.0.2 to scm:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy20.submitRequest over nodeId=scmNodeId,nodeAddress=scm/172.18.0.2:9860 after 1 failover attempts. Trying to failover after sleeping for 2000ms. Current retry count: 1. com.google.protobuf.ServiceException: java.net.ConnectException: Call From 981b2d535b01/172.18.0.2 to scm:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy20.submitRequest over nodeId=scmNodeId,nodeAddress=scm/172.18.0.2:9860 after 2 failover attempts. Trying to failover after sleeping for 2000ms. Current retry count: 2. com.google.protobuf.ServiceException: java.net.ConnectException: Call From 981b2d535b01/172.18.0.2 to scm:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy20.submitRequest over nodeId=scmNodeId,nodeAddress=scm/172.18.0.2:9860 after 3 failover attempts. Trying to failover after sleeping for 2000ms. Current retry count: 3. com.google.protobuf.ServiceException: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hdds.ratis.ServerNotLeaderException): Server:d2469009-7176-49f2-8cb4-f4e945561846 is not the leader. Could not determine the leader node. at org.apache.hadoop.hdds.ratis.ServerNotLeaderException.convertToNotLeaderException(ServerNotLeaderException.java:109) at org.apache.hadoop.hdds.scm.ha.RatisUtil.checkRatisException(RatisUtil.java:249) at org.apache.hadoop.hdds.scm.protocol.StorageContainerLocationProtocolServerSideTranslatorPB.submitRequest(StorageContainerLocationProtocolServerSideTranslatorPB.java:199) at org.apache.hadoop.hdds.protocol.proto.StorageContainerLocationProtocolProtos$StorageContainerLocationProtocolService$2.callBlockingMethod(StorageContainerLocationProtocolProtos.java) at org.apache.hadoop.ipc.ProtobufRpcEngine$Server.processCall(ProtobufRpcEngine.java:484) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:595) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:573) at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1213) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1089) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1012) at java.base/java.security.AccessController.doPrivileged(Native Method) at java.base/javax.security.auth.Subject.doAs(Subject.java:423) at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1899) at org.apache.hadoop.ipc.Server$Handler.run(Server.java:3026) , while invoking $Proxy20.submitRequest over nodeId=scmNodeId,nodeAddress=scm/172.18.0.2:9860 after 4 failover attempts. Trying to failover after sleeping for 2000ms. Current retry count: 4. com.google.protobuf.ServiceException: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hdds.ratis.ServerNotLeaderException): Server:d2469009-7176-49f2-8cb4-f4e945561846 is not the leader. Could not determine the leader node. at org.apache.hadoop.hdds.ratis.ServerNotLeaderException.convertToNotLeaderException(ServerNotLeaderException.java:109) at org.apache.hadoop.hdds.scm.ha.RatisUtil.checkRatisException(RatisUtil.java:249) at org.apache.hadoop.hdds.scm.protocol.StorageContainerLocationProtocolServerSideTranslatorPB.submitRequest(StorageContainerLocationProtocolServerSideTranslatorPB.java:199) at org.apache.hadoop.hdds.protocol.proto.StorageContainerLocationProtocolProtos$StorageContainerLocationProtocolService$2.callBlockingMethod(StorageContainerLocationProtocolProtos.java) at org.apache.hadoop.ipc.ProtobufRpcEngine$Server.processCall(ProtobufRpcEngine.java:484) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:595) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:573) at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1213) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1089) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1012) at java.base/java.security.AccessController.doPrivileged(Native Method) at java.base/javax.security.auth.Subject.doAs(Subject.java:423) at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1899) at org.apache.hadoop.ipc.Server$Handler.run(Server.java:3026) , while invoking $Proxy20.submitRequest over nodeId=scmNodeId,nodeAddress=scm/172.18.0.2:9860 after 5 failover attempts. Trying to failover after sleeping for 2000ms. Current retry count: 5. com.google.protobuf.ServiceException: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hdds.ratis.ServerNotLeaderException): Server:d2469009-7176-49f2-8cb4-f4e945561846 is not the leader. Could not determine the leader node. at org.apache.hadoop.hdds.ratis.ServerNotLeaderException.convertToNotLeaderException(ServerNotLeaderException.java:109) at org.apache.hadoop.hdds.scm.ha.RatisUtil.checkRatisException(RatisUtil.java:249) at org.apache.hadoop.hdds.scm.protocol.StorageContainerLocationProtocolServerSideTranslatorPB.submitRequest(StorageContainerLocationProtocolServerSideTranslatorPB.java:199) at org.apache.hadoop.hdds.protocol.proto.StorageContainerLocationProtocolProtos$StorageContainerLocationProtocolService$2.callBlockingMethod(StorageContainerLocationProtocolProtos.java) at org.apache.hadoop.ipc.ProtobufRpcEngine$Server.processCall(ProtobufRpcEngine.java:484) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:595) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:573) at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1213) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1089) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1012) at java.base/java.security.AccessController.doPrivileged(Native Method) at java.base/javax.security.auth.Subject.doAs(Subject.java:423) at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1899) at org.apache.hadoop.ipc.Server$Handler.run(Server.java:3026) , while invoking $Proxy20.submitRequest over nodeId=scmNodeId,nodeAddress=scm/172.18.0.2:9860 after 6 failover attempts. Trying to failover after sleeping for 2000ms. Current retry count: 6. SCM is in safe mode. validated:false, DataNodeSafeModeRule, registered datanodes (=0) >= required datanodes (=1) validated:true, HealthyPipelineSafeModeRule, healthy Ratis/THREE pipelines (=0) >= healthyPipelineThresholdCount (=0) validated:true, ContainerSafeModeRule, % of containers with at least one reported replica (=1.00) >= safeModeCutoff (=0.99) validated:true, AtleastOneDatanodeReportedRule, reported Ratis/THREE pipelines with at least one datanode (=0) >= threshold (=0)
WARNING: HADOOP_OPTS has been deprecated by OZONE_OPTS.
SECONDS: 44
SCM is out of safe mode.
Safe mode is off
No OM HA service, no need to wait
==============================================================================
Dn :: Test datanode compatibility                                             
==============================================================================
Picks up command line options                                         | PASS |
------------------------------------------------------------------------------
Dn :: Test datanode compatibility                                     | PASS |
1 test, 1 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/compatibility/result/robot-compatibility-compatibility-dn-datanode.xml
==============================================================================
Om :: Test om compatibility                                                   
==============================================================================
Picks up command line options                                         | PASS |
------------------------------------------------------------------------------
Om :: Test om compatibility                                           | PASS |
1 test, 1 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/compatibility/result/robot-compatibility-compatibility-dn-datanode-1.xml
==============================================================================
Recon :: Test recon compatibility                                             
==============================================================================
Picks up command line options                                         | PASS |
------------------------------------------------------------------------------
Recon :: Test recon compatibility                                     | PASS |
1 test, 1 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/compatibility/result/robot-compatibility-compatibility-dn-datanode-2.xml
==============================================================================
Scm :: Test scm compatibility                                                 
==============================================================================
Picks up command line options                                         | PASS |
------------------------------------------------------------------------------
Scm :: Test scm compatibility                                         | PASS |
1 test, 1 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/compatibility/result/robot-compatibility-compatibility-dn-datanode-3.xml
==============================================================================
Dn-One-Rocksdb :: Test merge rocksdb in datanode compatibility                
==============================================================================
Create a container and check container schema version                 | PASS |
------------------------------------------------------------------------------
Dn-One-Rocksdb :: Test merge rocksdb in datanode compatibility        | PASS |
1 test, 1 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/compatibility/result/robot-compatibility-compatibility-dn-datanode-4.xml
Stopping compatibility_datanode_1 ... 
Stopping compatibility_om_1       ... 
Stopping compatibility_recon_1    ... 
Stopping compatibility_scm_1      ... 
Stopping compatibility_s3g_1      ... 
Stopping compatibility_s3g_1      ... done
Stopping compatibility_recon_1    ... done
Stopping compatibility_datanode_1 ... done
Stopping compatibility_om_1       ... done
Stopping compatibility_scm_1      ... done
Removing compatibility_datanode_1 ... 
Removing compatibility_om_1       ... 
Removing compatibility_recon_1    ... 
Removing compatibility_scm_1      ... 
Removing compatibility_s3g_1      ... 
Removing compatibility_om_1       ... done
Removing compatibility_s3g_1      ... done
Removing compatibility_datanode_1 ... done
Removing compatibility_scm_1      ... done
Removing compatibility_recon_1    ... done
Removing network compatibility_default
Log:     /home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/compatibility/result/log.html
Report:  /home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/compatibility/result/report.html
Output:  /home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/result/compatibility.xml
removed 'compatibility/result/robot-compatibility-compatibility-dn-datanode-1.xml'
removed 'compatibility/result/robot-compatibility-compatibility-dn-datanode-2.xml'
removed 'compatibility/result/robot-compatibility-compatibility-dn-datanode-3.xml'
removed 'compatibility/result/robot-compatibility-compatibility-dn-datanode-4.xml'
removed 'compatibility/result/robot-compatibility-compatibility-dn-datanode.xml'
removed 'compatibility/result/log.html'
removed 'compatibility/result/report.html'
renamed 'compatibility/result/dn-audit-1f4f2a17590a.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/result/compatibility/dn-audit-1f4f2a17590a.log'
renamed 'compatibility/result/docker-compatibility-compatibility-dn-datanode.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/result/compatibility/docker-compatibility-compatibility-dn-datanode.log'
renamed 'compatibility/result/om-audit-d01a55e85005.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/result/compatibility/om-audit-d01a55e85005.log'
renamed 'compatibility/result/s3g-audit-fe13c6cd7e53.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/result/compatibility/s3g-audit-fe13c6cd7e53.log'
renamed 'compatibility/result/scm-audit-981b2d535b01.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/result/compatibility/scm-audit-981b2d535b01.log'
Executing test upgrade/test.sh
chown: changing ownership of '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/data/scm3': Operation not permitted
chown: changing ownership of '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/data/scm2': Operation not permitted
chown: changing ownership of '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/data/om3': Operation not permitted
chown: changing ownership of '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/data/dn5': Operation not permitted
chown: changing ownership of '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/data/om2': Operation not permitted
chown: changing ownership of '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/data/dn1': Operation not permitted
chown: changing ownership of '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/data/recon': Operation not permitted
chown: changing ownership of '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/data/s3g': Operation not permitted
chown: changing ownership of '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/data/scm1': Operation not permitted
chown: changing ownership of '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/data/dn2': Operation not permitted
chown: changing ownership of '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/data/dn4': Operation not permitted
chown: changing ownership of '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/data/dn3': Operation not permitted
chown: changing ownership of '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/data/om1': Operation not permitted
chown: changing ownership of '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/data': Operation not permitted
Using docker cluster defined in /home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/compose/ha/docker-compose.yaml
Executing test /home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/./driver.sh
--- RUNNING NON-ROLLING UPGRADE TEST FROM 1.3.0 TO 1.4.0 ---
--- SETTING UP OLD VERSION 1.3.0 ---
--- RUNNING WITH OLD VERSION 1.3.0 ---
Removing network ha_net
Network ha_net not found.
Creating network "ha_net" with driver "bridge"
Pulling om1 (apache/ozone:1.3.0)...
1.3.0: Pulling from apache/ozone
Digest: sha256:e3ca5257269d23a09d878fbabc947a0ea65d9040903341478d38d5ed8cc702fd
Status: Downloaded newer image for apache/ozone:1.3.0
Creating ha_om2_1 ... 
Creating ha_dn3_1 ... 
Creating ha_dn1_1 ... 
Creating ha_scm3_1 ... 
Creating ha_dn5_1  ... 
Creating ha_s3g_1  ... 
Creating ha_scm2_1 ... 
Creating ha_dn2_1  ... 
Creating ha_recon_1 ... 
Creating ha_scm1_1  ... 
Creating ha_om3_1   ... 
Creating ha_om1_1   ... 
Creating ha_dn4_1   ... 
Creating ha_dn1_1   ... done
Creating ha_dn3_1   ... done
Creating ha_scm3_1  ... done
Creating ha_scm2_1  ... done
Creating ha_dn5_1   ... done
Creating ha_om2_1   ... done
Creating ha_s3g_1   ... done
Creating ha_scm1_1  ... done
Creating ha_dn2_1   ... done
Creating ha_recon_1 ... done
Creating ha_om1_1   ... done
Creating ha_dn4_1   ... done
Creating ha_om3_1   ... done
SECONDS: 62
com.google.protobuf.ServiceException: java.net.ConnectException: Call From 4fc2286e66ff/10.9.0.14 to scm2:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy19.submitRequest over nodeId=scm2,nodeAddress=scm2/10.9.0.15:9860 after 1 failover attempts. Trying to failover after sleeping for 2000ms. com.google.protobuf.ServiceException: java.net.ConnectException: Call From 4fc2286e66ff/10.9.0.14 to scm3:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy19.submitRequest over nodeId=scm3,nodeAddress=scm3/10.9.0.16:9860 after 2 failover attempts. Trying to failover after sleeping for 2000ms. com.google.protobuf.ServiceException: java.net.ConnectException: Call From 4fc2286e66ff/10.9.0.14 to scm1:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy19.submitRequest over nodeId=scm1,nodeAddress=scm1/10.9.0.14:9860 after 3 failover attempts. Trying to failover after sleeping for 2000ms. com.google.protobuf.ServiceException: java.net.ConnectException: Call From 4fc2286e66ff/10.9.0.14 to scm2:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy19.submitRequest over nodeId=scm2,nodeAddress=scm2/10.9.0.15:9860 after 4 failover attempts. Trying to failover after sleeping for 2000ms. com.google.protobuf.ServiceException: java.net.ConnectException: Call From 4fc2286e66ff/10.9.0.14 to scm3:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy19.submitRequest over nodeId=scm3,nodeAddress=scm3/10.9.0.16:9860 after 5 failover attempts. Trying to failover after sleeping for 2000ms. com.google.protobuf.ServiceException: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hdds.ratis.ServerNotLeaderException): Server:b49fb8c8-35ea-4c3c-9e07-6a74a5029996 is not the leader. Could not determine the leader node. at org.apache.hadoop.hdds.ratis.ServerNotLeaderException.convertToNotLeaderException(ServerNotLeaderException.java:109) at org.apache.hadoop.hdds.scm.ha.RatisUtil.checkRatisException(RatisUtil.java:246) at org.apache.hadoop.hdds.scm.protocol.StorageContainerLocationProtocolServerSideTranslatorPB.submitRequest(StorageContainerLocationProtocolServerSideTranslatorPB.java:193) at org.apache.hadoop.hdds.protocol.proto.StorageContainerLocationProtocolProtos$StorageContainerLocationProtocolService$2.callBlockingMethod(StorageContainerLocationProtocolProtos.java:62732) at org.apache.hadoop.ipc.ProtobufRpcEngine$Server.processCall(ProtobufRpcEngine.java:465) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:578) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:556) at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1093) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1043) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:971) at java.base/java.security.AccessController.doPrivileged(Native Method) at java.base/javax.security.auth.Subject.doAs(Subject.java:423) at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1878) at org.apache.hadoop.ipc.Server$Handler.run(Server.java:2976) , while invoking $Proxy19.submitRequest over nodeId=scm1,nodeAddress=scm1/10.9.0.14:9860 after 6 failover attempts. Trying to failover after sleeping for 2000ms. com.google.protobuf.ServiceException: java.net.ConnectException: Call From 4fc2286e66ff/10.9.0.14 to scm2:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy19.submitRequest over nodeId=scm2,nodeAddress=scm2/10.9.0.15:9860 after 7 failover attempts. Trying to failover after sleeping for 2000ms. com.google.protobuf.ServiceException: java.net.ConnectException: Call From 4fc2286e66ff/10.9.0.14 to scm3:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy19.submitRequest over nodeId=scm3,nodeAddress=scm3/10.9.0.16:9860 after 8 failover attempts. Trying to failover after sleeping for 2000ms. SCM is in safe mode. validated:true, DataNodeSafeModeRule, registered datanodes (=3) >= required datanodes (=3) validated:false, HealthyPipelineSafeModeRule, healthy Ratis/THREE pipelines (=0) >= healthyPipelineThresholdCount (=1) validated:true, ContainerSafeModeRule, % of containers with at least one reported replica (=1.00) >= safeModeCutoff (=0.99) validated:true, AtleastOneDatanodeReportedRule, reported Ratis/THREE pipelines with at least one datanode (=0) >= threshold (=0)
SECONDS: 78
SCM is in safe mode. validated:true, DataNodeSafeModeRule, registered datanodes (=3) >= required datanodes (=3) validated:false, HealthyPipelineSafeModeRule, healthy Ratis/THREE pipelines (=0) >= healthyPipelineThresholdCount (=1) validated:true, ContainerSafeModeRule, % of containers with at least one reported replica (=1.00) >= safeModeCutoff (=0.99) validated:true, AtleastOneDatanodeReportedRule, reported Ratis/THREE pipelines with at least one datanode (=0) >= threshold (=0)
SECONDS: 96
SCM is in safe mode. validated:true, DataNodeSafeModeRule, registered datanodes (=3) >= required datanodes (=3) validated:false, HealthyPipelineSafeModeRule, healthy Ratis/THREE pipelines (=0) >= healthyPipelineThresholdCount (=1) validated:true, ContainerSafeModeRule, % of containers with at least one reported replica (=1.00) >= safeModeCutoff (=0.99) validated:true, AtleastOneDatanodeReportedRule, reported Ratis/THREE pipelines with at least one datanode (=0) >= threshold (=0)
SECONDS: 104
SCM is in safe mode. validated:true, DataNodeSafeModeRule, registered datanodes (=3) >= required datanodes (=3) validated:false, HealthyPipelineSafeModeRule, healthy Ratis/THREE pipelines (=0) >= healthyPipelineThresholdCount (=1) validated:true, ContainerSafeModeRule, % of containers with at least one reported replica (=1.00) >= safeModeCutoff (=0.99) validated:true, AtleastOneDatanodeReportedRule, reported Ratis/THREE pipelines with at least one datanode (=0) >= threshold (=0)
SECONDS: 109
SCM is out of safe mode.
Safe mode is off
Found OM leader for service omservice: om2 : LEADER (om2)
Replaced OM order with om2,om3,om1 in ha_recon_1
Replaced OM order with om2,om3,om1 in ha_s3g_1
Replaced OM order with om2,om3,om1 in ha_scm1_1
Replaced OM order with om2,om3,om1 in ha_scm2_1
Replaced OM order with om2,om3,om1 in ha_scm3_1
==============================================================================
Check-Finalization :: Finalize Upgrade of the Ozone cluster                   
==============================================================================
Check OM Finalized                                                    | PASS |
------------------------------------------------------------------------------
Check SCM Finalized                                                   | PASS |
------------------------------------------------------------------------------
Check-Finalization :: Finalize Upgrade of the Ozone cluster           | PASS |
2 tests, 2 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.3.0-original.xml
==============================================================================
Generate :: Generate data                                                     
==============================================================================
Create a volume and bucket                                            | PASS |
------------------------------------------------------------------------------
Create key                                                            | PASS |
------------------------------------------------------------------------------
Create a bucket in s3v volume                                         | PASS |
------------------------------------------------------------------------------
Create key in the bucket in s3v volume                                | PASS |
------------------------------------------------------------------------------
Setup credentials for S3                                              | PASS |
------------------------------------------------------------------------------
Try to create a bucket using S3 API                                   | PASS |
------------------------------------------------------------------------------
Create key using S3 API                                               | PASS |
------------------------------------------------------------------------------
Generate :: Generate data                                             | PASS |
7 tests, 7 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.3.0-original-1.xml
==============================================================================
Validate :: Smoketest ozone cluster startup                                   
==============================================================================
Read data from previously created key                                 | PASS |
------------------------------------------------------------------------------
Setup credentials for S3                                              | PASS |
------------------------------------------------------------------------------
Read key created with Ozone Shell using S3 API                        | PASS |
------------------------------------------------------------------------------
Read key created with S3 API using S3 API                             | PASS |
------------------------------------------------------------------------------
Validate :: Smoketest ozone cluster startup                           | PASS |
4 tests, 4 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.3.0-original-2.xml
==============================================================================
Prepare :: Prepares OMs                                                       
==============================================================================
Prepare Ozone Manager                                                 | PASS |
------------------------------------------------------------------------------
Prepare :: Prepares OMs                                               | PASS |
1 test, 1 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.3.0-original-3.xml
Stopping ha_om3_1   ... 
Stopping ha_dn4_1   ... 
Stopping ha_om1_1   ... 
Stopping ha_recon_1 ... 
Stopping ha_dn2_1   ... 
Stopping ha_scm1_1  ... 
Stopping ha_s3g_1   ... 
Stopping ha_dn5_1   ... 
Stopping ha_scm2_1  ... 
Stopping ha_scm3_1  ... 
Stopping ha_om2_1   ... 
Stopping ha_dn1_1   ... 
Stopping ha_dn3_1   ... 
Stopping ha_s3g_1   ... done
Stopping ha_om1_1   ... done
Stopping ha_om2_1   ... done
Stopping ha_om3_1   ... done
Stopping ha_recon_1 ... done
Stopping ha_dn2_1   ... done
Stopping ha_dn3_1   ... done
Stopping ha_dn1_1   ... done
Stopping ha_dn5_1   ... done
Stopping ha_dn4_1   ... done
Stopping ha_scm3_1  ... done
Stopping ha_scm1_1  ... done
Stopping ha_scm2_1  ... done
Removing ha_om3_1   ... 
Removing ha_dn4_1   ... 
Removing ha_om1_1   ... 
Removing ha_recon_1 ... 
Removing ha_dn2_1   ... 
Removing ha_scm1_1  ... 
Removing ha_s3g_1   ... 
Removing ha_dn5_1   ... 
Removing ha_scm2_1  ... 
Removing ha_scm3_1  ... 
Removing ha_om2_1   ... 
Removing ha_dn1_1   ... 
Removing ha_dn3_1   ... 
Removing ha_dn1_1   ... done
Removing ha_dn4_1   ... done
Removing ha_scm1_1  ... done
Removing ha_dn2_1   ... done
Removing ha_om2_1   ... done
Removing ha_om1_1   ... done
Removing ha_scm2_1  ... done
Removing ha_s3g_1   ... done
Removing ha_recon_1 ... done
Removing ha_om3_1   ... done
Removing ha_scm3_1  ... done
Removing ha_dn5_1   ... done
Removing ha_dn3_1   ... done
Removing network ha_net
--- RUNNING WITH NEW VERSION 1.4.0 PRE-FINALIZED ---
Removing network ha_net
Network ha_net not found.
Creating network "ha_net" with driver "bridge"
Creating ha_dn1_1 ... 
Creating ha_scm1_1 ... 
Creating ha_om1_1  ... 
Creating ha_scm2_1 ... 
Creating ha_recon_1 ... 
Creating ha_dn2_1   ... 
Creating ha_s3g_1   ... 
Creating ha_scm3_1  ... 
Creating ha_dn3_1   ... 
Creating ha_dn4_1   ... 
Creating ha_dn5_1   ... 
Creating ha_om2_1   ... 
Creating ha_om3_1   ... 
Creating ha_dn2_1   ... done
Creating ha_scm1_1  ... done
Creating ha_scm2_1  ... done
Creating ha_dn1_1   ... done
Creating ha_om1_1   ... done
Creating ha_om2_1   ... done
Creating ha_scm3_1  ... done
Creating ha_s3g_1   ... done
Creating ha_dn4_1   ... done
Creating ha_recon_1 ... done
Creating ha_dn3_1   ... done
Creating ha_dn5_1   ... done
Creating ha_om3_1   ... done
SECONDS: 70
com.google.protobuf.ServiceException: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hdds.ratis.ServerNotLeaderException): Server:b49fb8c8-35ea-4c3c-9e07-6a74a5029996 is not the leader. Could not determine the leader node. at org.apache.hadoop.hdds.ratis.ServerNotLeaderException.convertToNotLeaderException(ServerNotLeaderException.java:109) at org.apache.hadoop.hdds.scm.ha.RatisUtil.checkRatisException(RatisUtil.java:249) at org.apache.hadoop.hdds.scm.protocol.StorageContainerLocationProtocolServerSideTranslatorPB.submitRequest(StorageContainerLocationProtocolServerSideTranslatorPB.java:199) at org.apache.hadoop.hdds.protocol.proto.StorageContainerLocationProtocolProtos$StorageContainerLocationProtocolService$2.callBlockingMethod(StorageContainerLocationProtocolProtos.java) at org.apache.hadoop.ipc.ProtobufRpcEngine$Server.processCall(ProtobufRpcEngine.java:484) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:595) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:573) at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1213) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1089) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1012) at java.base/java.security.AccessController.doPrivileged(Native Method) at java.base/javax.security.auth.Subject.doAs(Subject.java:423) at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1899) at org.apache.hadoop.ipc.Server$Handler.run(Server.java:3026) , while invoking $Proxy20.submitRequest over nodeId=scm1,nodeAddress=scm1/10.9.0.14:9860 after 3 failover attempts. Trying to failover after sleeping for 2000ms. Current retry count: 3. com.google.protobuf.ServiceException: java.net.ConnectException: Call From f3fd66eba431/10.9.0.14 to scm2:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy20.submitRequest over nodeId=scm2,nodeAddress=scm2/10.9.0.15:9860 after 4 failover attempts. Trying to failover after sleeping for 2000ms. Current retry count: 4. com.google.protobuf.ServiceException: java.net.ConnectException: Call From f3fd66eba431/10.9.0.14 to scm3:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy20.submitRequest over nodeId=scm3,nodeAddress=scm3/10.9.0.16:9860 after 5 failover attempts. Trying to failover after sleeping for 2000ms. Current retry count: 5. com.google.protobuf.ServiceException: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hdds.ratis.ServerNotLeaderException): Server:b49fb8c8-35ea-4c3c-9e07-6a74a5029996 is not the leader. Could not determine the leader node. at org.apache.hadoop.hdds.ratis.ServerNotLeaderException.convertToNotLeaderException(ServerNotLeaderException.java:109) at org.apache.hadoop.hdds.scm.ha.RatisUtil.checkRatisException(RatisUtil.java:249) at org.apache.hadoop.hdds.scm.protocol.StorageContainerLocationProtocolServerSideTranslatorPB.submitRequest(StorageContainerLocationProtocolServerSideTranslatorPB.java:199) at org.apache.hadoop.hdds.protocol.proto.StorageContainerLocationProtocolProtos$StorageContainerLocationProtocolService$2.callBlockingMethod(StorageContainerLocationProtocolProtos.java) at org.apache.hadoop.ipc.ProtobufRpcEngine$Server.processCall(ProtobufRpcEngine.java:484) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:595) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:573) at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1213) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1089) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1012) at java.base/java.security.AccessController.doPrivileged(Native Method) at java.base/javax.security.auth.Subject.doAs(Subject.java:423) at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1899) at org.apache.hadoop.ipc.Server$Handler.run(Server.java:3026) , while invoking $Proxy20.submitRequest over nodeId=scm1,nodeAddress=scm1/10.9.0.14:9860 after 6 failover attempts. Trying to failover after sleeping for 2000ms. Current retry count: 6. com.google.protobuf.ServiceException: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hdds.ratis.ServerNotLeaderException): Server:3c6d46e4-d9b6-47ab-9944-2c59eddc2bb8 is not the leader. Could not determine the leader node. at org.apache.hadoop.hdds.ratis.ServerNotLeaderException.convertToNotLeaderException(ServerNotLeaderException.java:109) at org.apache.hadoop.hdds.scm.ha.RatisUtil.checkRatisException(RatisUtil.java:249) at org.apache.hadoop.hdds.scm.protocol.StorageContainerLocationProtocolServerSideTranslatorPB.submitRequest(StorageContainerLocationProtocolServerSideTranslatorPB.java:199) at org.apache.hadoop.hdds.protocol.proto.StorageContainerLocationProtocolProtos$StorageContainerLocationProtocolService$2.callBlockingMethod(StorageContainerLocationProtocolProtos.java) at org.apache.hadoop.ipc.ProtobufRpcEngine$Server.processCall(ProtobufRpcEngine.java:484) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:595) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:573) at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1213) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1089) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1012) at java.base/java.security.AccessController.doPrivileged(Native Method) at java.base/javax.security.auth.Subject.doAs(Subject.java:423) at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1899) at org.apache.hadoop.ipc.Server$Handler.run(Server.java:3026) , while invoking $Proxy20.submitRequest over nodeId=scm2,nodeAddress=scm2/10.9.0.15:9860 after 7 failover attempts. Trying to failover after sleeping for 2000ms. Current retry count: 7. com.google.protobuf.ServiceException: java.net.ConnectException: Call From f3fd66eba431/10.9.0.14 to scm3:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy20.submitRequest over nodeId=scm3,nodeAddress=scm3/10.9.0.16:9860 after 8 failover attempts. Trying to failover after sleeping for 2000ms. Current retry count: 8. SCM is in safe mode. validated:false, DataNodeSafeModeRule, registered datanodes (=0) >= required datanodes (=3) validated:false, HealthyPipelineSafeModeRule, healthy Ratis/THREE pipelines (=0) >= healthyPipelineThresholdCount (=1) validated:true, ContainerSafeModeRule, % of containers with at least one reported replica (=1.00) >= safeModeCutoff (=0.99) validated:false, AtleastOneDatanodeReportedRule, reported Ratis/THREE pipelines with at least one datanode (=0) >= threshold (=2)
SECONDS: 96
SCM is out of safe mode.
Safe mode is off
Found OM leader for service omservice: om3 : LEADER (om3)
Replaced OM order with om3,om2,om1 in ha_recon_1
Replaced OM order with om3,om2,om1 in ha_s3g_1
Replaced OM order with om3,om2,om1 in ha_scm1_1
Replaced OM order with om3,om2,om1 in ha_scm2_1
Replaced OM order with om3,om2,om1 in ha_scm3_1
==============================================================================
Validate :: Smoketest ozone cluster startup                                   
==============================================================================
Read data from previously created key                                 | PASS |
------------------------------------------------------------------------------
Setup credentials for S3                                              | PASS |
------------------------------------------------------------------------------
Read key created with Ozone Shell using S3 API                        | PASS |
------------------------------------------------------------------------------
Read key created with S3 API using S3 API                             | PASS |
------------------------------------------------------------------------------
Validate :: Smoketest ozone cluster startup                           | PASS |
4 tests, 4 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.4.0-pre-finalized.xml
==============================================================================
Generate :: Generate data                                                     
==============================================================================
Create key                                                            | PASS |
------------------------------------------------------------------------------
Create key in the bucket in s3v volume                                | PASS |
------------------------------------------------------------------------------
Setup credentials for S3                                              | PASS |
------------------------------------------------------------------------------
Try to create a bucket using S3 API                                   | PASS |
------------------------------------------------------------------------------
Create key using S3 API                                               | PASS |
------------------------------------------------------------------------------
Generate :: Generate data                                             | PASS |
5 tests, 5 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.4.0-pre-finalized-1.xml
==============================================================================
Generate :: Generate data                                                     
==============================================================================
Create a volume and bucket                                            | PASS |
------------------------------------------------------------------------------
Create key                                                            | PASS |
------------------------------------------------------------------------------
Create a bucket in s3v volume                                         | PASS |
------------------------------------------------------------------------------
Create key in the bucket in s3v volume                                | PASS |
------------------------------------------------------------------------------
Setup credentials for S3                                              | PASS |
------------------------------------------------------------------------------
Try to create a bucket using S3 API                                   | PASS |
------------------------------------------------------------------------------
Create key using S3 API                                               | PASS |
------------------------------------------------------------------------------
Generate :: Generate data                                             | PASS |
7 tests, 7 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.4.0-pre-finalized-2.xml
==============================================================================
Validate :: Smoketest ozone cluster startup                                   
==============================================================================
Read data from previously created key                                 | PASS |
------------------------------------------------------------------------------
Setup credentials for S3                                              | PASS |
------------------------------------------------------------------------------
Read key created with Ozone Shell using S3 API                        | PASS |
------------------------------------------------------------------------------
Read key created with S3 API using S3 API                             | PASS |
------------------------------------------------------------------------------
Validate :: Smoketest ozone cluster startup                           | PASS |
4 tests, 4 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.4.0-pre-finalized-3.xml
==============================================================================
Check-Finalization :: Finalize Upgrade of the Ozone cluster                   
==============================================================================
Check OM Pre Finalized                                                | PASS |
------------------------------------------------------------------------------
Check SCM Pre Finalized                                               | PASS |
------------------------------------------------------------------------------
Check-Finalization :: Finalize Upgrade of the Ozone cluster           | PASS |
2 tests, 2 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.4.0-pre-finalized-4.xml
==============================================================================
Upgrade-Snapshot-Check :: Smoketest ozone cluster snapshot feature            
==============================================================================
Attempt to create snapshot when snapshot feature is disabled          | PASS |
------------------------------------------------------------------------------
Attempt to list snapshot when snapshot feature is disabled            | PASS |
------------------------------------------------------------------------------
Attempt to snapshotDiff when snapshot feature is disabled             | PASS |
------------------------------------------------------------------------------
Attempt to delete when snapshot feature is disabled                   | PASS |
------------------------------------------------------------------------------
Upgrade-Snapshot-Check :: Smoketest ozone cluster snapshot feature    | PASS |
4 tests, 4 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.4.0-pre-finalized-5.xml
==============================================================================
Prepare :: Prepares OMs                                                       
==============================================================================
Prepare Ozone Manager                                                 | PASS |
------------------------------------------------------------------------------
Prepare :: Prepares OMs                                               | PASS |
1 test, 1 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.4.0-pre-finalized-6.xml
Stopping ha_om3_1   ... 
Stopping ha_om2_1   ... 
Stopping ha_dn3_1   ... 
Stopping ha_dn5_1   ... 
Stopping ha_dn4_1   ... 
Stopping ha_scm3_1  ... 
Stopping ha_s3g_1   ... 
Stopping ha_dn2_1   ... 
Stopping ha_recon_1 ... 
Stopping ha_dn1_1   ... 
Stopping ha_scm2_1  ... 
Stopping ha_om1_1   ... 
Stopping ha_scm1_1  ... 
Stopping ha_om1_1   ... done
Stopping ha_om3_1   ... done
Stopping ha_om2_1   ... done
Stopping ha_s3g_1   ... done
Stopping ha_dn2_1   ... done
Stopping ha_dn1_1   ... done
Stopping ha_dn5_1   ... done
Stopping ha_dn4_1   ... done
Stopping ha_dn3_1   ... done
Stopping ha_recon_1 ... done
Stopping ha_scm1_1  ... done
Stopping ha_scm3_1  ... done
Stopping ha_scm2_1  ... done
Removing ha_om3_1   ... 
Removing ha_om2_1   ... 
Removing ha_dn3_1   ... 
Removing ha_dn5_1   ... 
Removing ha_dn4_1   ... 
Removing ha_scm3_1  ... 
Removing ha_s3g_1   ... 
Removing ha_dn2_1   ... 
Removing ha_recon_1 ... 
Removing ha_dn1_1   ... 
Removing ha_scm2_1  ... 
Removing ha_om1_1   ... 
Removing ha_scm1_1  ... 
Removing ha_dn5_1   ... done
Removing ha_om2_1   ... done
Removing ha_dn2_1   ... done
Removing ha_scm1_1  ... done
Removing ha_dn3_1   ... done
Removing ha_dn1_1   ... done
Removing ha_om1_1   ... done
Removing ha_om3_1   ... done
Removing ha_dn4_1   ... done
Removing ha_s3g_1   ... done
Removing ha_scm2_1  ... done
Removing ha_scm3_1  ... done
Removing ha_recon_1 ... done
Removing network ha_net
--- RUNNING WITH OLD VERSION 1.3.0 AFTER DOWNGRADE ---
Removing network ha_net
Network ha_net not found.
Creating network "ha_net" with driver "bridge"
Creating ha_om2_1 ... 
Creating ha_dn3_1 ... 
Creating ha_dn2_1 ... 
Creating ha_om3_1 ... 
Creating ha_om1_1 ... 
Creating ha_dn4_1 ... 
Creating ha_scm3_1 ... 
Creating ha_recon_1 ... 
Creating ha_s3g_1   ... 
Creating ha_dn5_1   ... 
Creating ha_scm1_1  ... 
Creating ha_scm2_1  ... 
Creating ha_dn1_1   ... 
Creating ha_om2_1   ... done
Creating ha_scm3_1  ... done
Creating ha_dn2_1   ... done
Creating ha_s3g_1   ... done
Creating ha_recon_1 ... done
Creating ha_om3_1   ... done
Creating ha_scm1_1  ... done
Creating ha_scm2_1  ... done
Creating ha_dn3_1   ... done
Creating ha_om1_1   ... done
Creating ha_dn4_1   ... done
Creating ha_dn5_1   ... done
Creating ha_dn1_1   ... done
SECONDS: 65
com.google.protobuf.ServiceException: java.net.ConnectException: Call From 4d4d2140adc4/10.9.0.14 to scm2:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy19.submitRequest over nodeId=scm2,nodeAddress=scm2/10.9.0.15:9860 after 1 failover attempts. Trying to failover after sleeping for 2000ms. com.google.protobuf.ServiceException: java.net.ConnectException: Call From 4d4d2140adc4/10.9.0.14 to scm3:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy19.submitRequest over nodeId=scm3,nodeAddress=scm3/10.9.0.16:9860 after 2 failover attempts. Trying to failover after sleeping for 2000ms. com.google.protobuf.ServiceException: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hdds.ratis.ServerNotLeaderException): Server:b49fb8c8-35ea-4c3c-9e07-6a74a5029996 is not the leader. Could not determine the leader node. at org.apache.hadoop.hdds.ratis.ServerNotLeaderException.convertToNotLeaderException(ServerNotLeaderException.java:109) at org.apache.hadoop.hdds.scm.ha.RatisUtil.checkRatisException(RatisUtil.java:246) at org.apache.hadoop.hdds.scm.protocol.StorageContainerLocationProtocolServerSideTranslatorPB.submitRequest(StorageContainerLocationProtocolServerSideTranslatorPB.java:193) at org.apache.hadoop.hdds.protocol.proto.StorageContainerLocationProtocolProtos$StorageContainerLocationProtocolService$2.callBlockingMethod(StorageContainerLocationProtocolProtos.java:62732) at org.apache.hadoop.ipc.ProtobufRpcEngine$Server.processCall(ProtobufRpcEngine.java:465) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:578) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:556) at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1093) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1043) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:971) at java.base/java.security.AccessController.doPrivileged(Native Method) at java.base/javax.security.auth.Subject.doAs(Subject.java:423) at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1878) at org.apache.hadoop.ipc.Server$Handler.run(Server.java:2976) , while invoking $Proxy19.submitRequest over nodeId=scm1,nodeAddress=scm1/10.9.0.14:9860 after 3 failover attempts. Trying to failover after sleeping for 2000ms. com.google.protobuf.ServiceException: java.net.ConnectException: Call From 4d4d2140adc4/10.9.0.14 to scm2:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy19.submitRequest over nodeId=scm2,nodeAddress=scm2/10.9.0.15:9860 after 4 failover attempts. Trying to failover after sleeping for 2000ms. com.google.protobuf.ServiceException: java.net.ConnectException: Call From 4d4d2140adc4/10.9.0.14 to scm3:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy19.submitRequest over nodeId=scm3,nodeAddress=scm3/10.9.0.16:9860 after 5 failover attempts. Trying to failover after sleeping for 2000ms. com.google.protobuf.ServiceException: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hdds.ratis.ServerNotLeaderException): Server:b49fb8c8-35ea-4c3c-9e07-6a74a5029996 is not the leader. Could not determine the leader node. at org.apache.hadoop.hdds.ratis.ServerNotLeaderException.convertToNotLeaderException(ServerNotLeaderException.java:109) at org.apache.hadoop.hdds.scm.ha.RatisUtil.checkRatisException(RatisUtil.java:246) at org.apache.hadoop.hdds.scm.protocol.StorageContainerLocationProtocolServerSideTranslatorPB.submitRequest(StorageContainerLocationProtocolServerSideTranslatorPB.java:193) at org.apache.hadoop.hdds.protocol.proto.StorageContainerLocationProtocolProtos$StorageContainerLocationProtocolService$2.callBlockingMethod(StorageContainerLocationProtocolProtos.java:62732) at org.apache.hadoop.ipc.ProtobufRpcEngine$Server.processCall(ProtobufRpcEngine.java:465) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:578) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:556) at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1093) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1043) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:971) at java.base/java.security.AccessController.doPrivileged(Native Method) at java.base/javax.security.auth.Subject.doAs(Subject.java:423) at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1878) at org.apache.hadoop.ipc.Server$Handler.run(Server.java:2976) , while invoking $Proxy19.submitRequest over nodeId=scm1,nodeAddress=scm1/10.9.0.14:9860 after 6 failover attempts. Trying to failover after sleeping for 2000ms. com.google.protobuf.ServiceException: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hdds.ratis.ServerNotLeaderException): Server:3c6d46e4-d9b6-47ab-9944-2c59eddc2bb8 is not the leader. Could not determine the leader node. at org.apache.hadoop.hdds.ratis.ServerNotLeaderException.convertToNotLeaderException(ServerNotLeaderException.java:109) at org.apache.hadoop.hdds.scm.ha.RatisUtil.checkRatisException(RatisUtil.java:246) at org.apache.hadoop.hdds.scm.protocol.StorageContainerLocationProtocolServerSideTranslatorPB.submitRequest(StorageContainerLocationProtocolServerSideTranslatorPB.java:193) at org.apache.hadoop.hdds.protocol.proto.StorageContainerLocationProtocolProtos$StorageContainerLocationProtocolService$2.callBlockingMethod(StorageContainerLocationProtocolProtos.java:62732) at org.apache.hadoop.ipc.ProtobufRpcEngine$Server.processCall(ProtobufRpcEngine.java:465) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:578) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:556) at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1093) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1043) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:971) at java.base/java.security.AccessController.doPrivileged(Native Method) at java.base/javax.security.auth.Subject.doAs(Subject.java:423) at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1878) at org.apache.hadoop.ipc.Server$Handler.run(Server.java:2976) , while invoking $Proxy19.submitRequest over nodeId=scm2,nodeAddress=scm2/10.9.0.15:9860 after 7 failover attempts. Trying to failover after sleeping for 2000ms. com.google.protobuf.ServiceException: java.net.ConnectException: Call From 4d4d2140adc4/10.9.0.14 to scm3:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy19.submitRequest over nodeId=scm3,nodeAddress=scm3/10.9.0.16:9860 after 8 failover attempts. Trying to failover after sleeping for 2000ms. SCM is in safe mode. validated:true, DataNodeSafeModeRule, registered datanodes (=3) >= required datanodes (=3) validated:true, HealthyPipelineSafeModeRule, healthy Ratis/THREE pipelines (=1) >= healthyPipelineThresholdCount (=1) validated:true, ContainerSafeModeRule, % of containers with at least one reported replica (=1.00) >= safeModeCutoff (=0.99) validated:true, AtleastOneDatanodeReportedRule, reported Ratis/THREE pipelines with at least one datanode (=2) >= threshold (=2)
SECONDS: 80
SCM is out of safe mode.
Safe mode is off
Found OM leader for service omservice: om3 : LEADER (om3)
Replaced OM order with om3,om2,om1 in ha_recon_1
Replaced OM order with om3,om2,om1 in ha_s3g_1
Replaced OM order with om3,om2,om1 in ha_scm1_1
Replaced OM order with om3,om2,om1 in ha_scm2_1
Replaced OM order with om3,om2,om1 in ha_scm3_1
==============================================================================
Check-Finalization :: Finalize Upgrade of the Ozone cluster                   
==============================================================================
Check OM Finalized                                                    | PASS |
------------------------------------------------------------------------------
Check SCM Finalized                                                   | PASS |
------------------------------------------------------------------------------
Check-Finalization :: Finalize Upgrade of the Ozone cluster           | PASS |
2 tests, 2 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.3.0-downgraded.xml
==============================================================================
Validate :: Smoketest ozone cluster startup                                   
==============================================================================
Read data from previously created key                                 | PASS |
------------------------------------------------------------------------------
Setup credentials for S3                                              | PASS |
------------------------------------------------------------------------------
Read key created with Ozone Shell using S3 API                        | PASS |
------------------------------------------------------------------------------
Read key created with S3 API using S3 API                             | PASS |
------------------------------------------------------------------------------
Validate :: Smoketest ozone cluster startup                           | PASS |
4 tests, 4 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.3.0-downgraded-1.xml
==============================================================================
Validate :: Smoketest ozone cluster startup                                   
==============================================================================
Read data from previously created key                                 | PASS |
------------------------------------------------------------------------------
Setup credentials for S3                                              | PASS |
------------------------------------------------------------------------------
Read key created with Ozone Shell using S3 API                        | PASS |
------------------------------------------------------------------------------
Read key created with S3 API using S3 API                             | PASS |
------------------------------------------------------------------------------
Validate :: Smoketest ozone cluster startup                           | PASS |
4 tests, 4 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.3.0-downgraded-2.xml
==============================================================================
Generate :: Generate data                                                     
==============================================================================
Create a volume and bucket                                            | PASS |
------------------------------------------------------------------------------
Create key                                                            | PASS |
------------------------------------------------------------------------------
Create a bucket in s3v volume                                         | PASS |
------------------------------------------------------------------------------
Create key in the bucket in s3v volume                                | PASS |
------------------------------------------------------------------------------
Setup credentials for S3                                              | PASS |
------------------------------------------------------------------------------
Try to create a bucket using S3 API                                   | PASS |
------------------------------------------------------------------------------
Create key using S3 API                                               | PASS |
------------------------------------------------------------------------------
Generate :: Generate data                                             | PASS |
7 tests, 7 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.3.0-downgraded-3.xml
==============================================================================
Validate :: Smoketest ozone cluster startup                                   
==============================================================================
Read data from previously created key                                 | PASS |
------------------------------------------------------------------------------
Setup credentials for S3                                              | PASS |
------------------------------------------------------------------------------
Read key created with Ozone Shell using S3 API                        | PASS |
------------------------------------------------------------------------------
Read key created with S3 API using S3 API                             | PASS |
------------------------------------------------------------------------------
Validate :: Smoketest ozone cluster startup                           | PASS |
4 tests, 4 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.3.0-downgraded-4.xml
==============================================================================
Generate :: Generate data                                                     
==============================================================================
Create key                                                            | PASS |
------------------------------------------------------------------------------
Create key in the bucket in s3v volume                                | PASS |
------------------------------------------------------------------------------
Setup credentials for S3                                              | PASS |
------------------------------------------------------------------------------
Try to create a bucket using S3 API                                   | PASS |
------------------------------------------------------------------------------
Create key using S3 API                                               | PASS |
------------------------------------------------------------------------------
Generate :: Generate data                                             | PASS |
5 tests, 5 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.3.0-downgraded-5.xml
==============================================================================
Prepare :: Prepares OMs                                                       
==============================================================================
Prepare Ozone Manager                                                 | PASS |
------------------------------------------------------------------------------
Prepare :: Prepares OMs                                               | PASS |
1 test, 1 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.3.0-downgraded-6.xml
Stopping ha_scm1_1  ... 
Stopping ha_dn1_1   ... 
Stopping ha_scm2_1  ... 
Stopping ha_dn5_1   ... 
Stopping ha_recon_1 ... 
Stopping ha_s3g_1   ... 
Stopping ha_scm3_1  ... 
Stopping ha_dn4_1   ... 
Stopping ha_om3_1   ... 
Stopping ha_om1_1   ... 
Stopping ha_dn2_1   ... 
Stopping ha_dn3_1   ... 
Stopping ha_om2_1   ... 
Stopping ha_om2_1   ... done
Stopping ha_om3_1   ... done
Stopping ha_om1_1   ... done
Stopping ha_s3g_1   ... done
Stopping ha_recon_1 ... done
Stopping ha_dn2_1   ... done
Stopping ha_dn3_1   ... done
Stopping ha_dn4_1   ... done
Stopping ha_dn1_1   ... done
Stopping ha_dn5_1   ... done
Stopping ha_scm2_1  ... done
Stopping ha_scm1_1  ... done
Stopping ha_scm3_1  ... done
Removing ha_scm1_1  ... 
Removing ha_dn1_1   ... 
Removing ha_scm2_1  ... 
Removing ha_dn5_1   ... 
Removing ha_recon_1 ... 
Removing ha_s3g_1   ... 
Removing ha_scm3_1  ... 
Removing ha_dn4_1   ... 
Removing ha_om3_1   ... 
Removing ha_om1_1   ... 
Removing ha_dn2_1   ... 
Removing ha_dn3_1   ... 
Removing ha_om2_1   ... 
Removing ha_dn1_1   ... done
Removing ha_dn3_1   ... done
Removing ha_dn4_1   ... done
Removing ha_s3g_1   ... done
Removing ha_dn5_1   ... done
Removing ha_om1_1   ... done
Removing ha_dn2_1   ... done
Removing ha_om3_1   ... done
Removing ha_scm3_1  ... done
Removing ha_scm1_1  ... done
Removing ha_recon_1 ... done
Removing ha_scm2_1  ... done
Removing ha_om2_1   ... done
Removing network ha_net
--- RUNNING WITH NEW VERSION 1.4.0 FINALIZED ---
Removing network ha_net
Network ha_net not found.
Creating network "ha_net" with driver "bridge"
Creating ha_om1_1 ... 
Creating ha_dn4_1 ... 
Creating ha_s3g_1 ... 
Creating ha_scm1_1 ... 
Creating ha_scm2_1 ... 
Creating ha_dn1_1  ... 
Creating ha_dn5_1  ... 
Creating ha_recon_1 ... 
Creating ha_om2_1   ... 
Creating ha_dn2_1   ... 
Creating ha_scm3_1  ... 
Creating ha_om3_1   ... 
Creating ha_dn3_1   ... 
Creating ha_scm1_1  ... done
Creating ha_dn4_1   ... done
Creating ha_scm2_1  ... done
Creating ha_om1_1   ... done
Creating ha_s3g_1   ... done
Creating ha_dn5_1   ... done
Creating ha_dn1_1   ... done
Creating ha_scm3_1  ... done
Creating ha_recon_1 ... done
Creating ha_dn3_1   ... done
Creating ha_dn2_1   ... done
Creating ha_om2_1   ... done
Creating ha_om3_1   ... done
SECONDS: 69
com.google.protobuf.ServiceException: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hdds.ratis.ServerNotLeaderException): Server:b49fb8c8-35ea-4c3c-9e07-6a74a5029996 is not the leader. Could not determine the leader node. at org.apache.hadoop.hdds.ratis.ServerNotLeaderException.convertToNotLeaderException(ServerNotLeaderException.java:109) at org.apache.hadoop.hdds.scm.ha.RatisUtil.checkRatisException(RatisUtil.java:249) at org.apache.hadoop.hdds.scm.protocol.StorageContainerLocationProtocolServerSideTranslatorPB.submitRequest(StorageContainerLocationProtocolServerSideTranslatorPB.java:199) at org.apache.hadoop.hdds.protocol.proto.StorageContainerLocationProtocolProtos$StorageContainerLocationProtocolService$2.callBlockingMethod(StorageContainerLocationProtocolProtos.java) at org.apache.hadoop.ipc.ProtobufRpcEngine$Server.processCall(ProtobufRpcEngine.java:484) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:595) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:573) at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1213) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1089) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1012) at java.base/java.security.AccessController.doPrivileged(Native Method) at java.base/javax.security.auth.Subject.doAs(Subject.java:423) at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1899) at org.apache.hadoop.ipc.Server$Handler.run(Server.java:3026) , while invoking $Proxy20.submitRequest over nodeId=scm1,nodeAddress=scm1/10.9.0.14:9860 after 3 failover attempts. Trying to failover after sleeping for 2000ms. Current retry count: 3. com.google.protobuf.ServiceException: java.net.ConnectException: Call From e35c794942b9/10.9.0.14 to scm2:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy20.submitRequest over nodeId=scm2,nodeAddress=scm2/10.9.0.15:9860 after 4 failover attempts. Trying to failover after sleeping for 2000ms. Current retry count: 4. com.google.protobuf.ServiceException: java.net.ConnectException: Call From e35c794942b9/10.9.0.14 to scm3:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy20.submitRequest over nodeId=scm3,nodeAddress=scm3/10.9.0.16:9860 after 5 failover attempts. Trying to failover after sleeping for 2000ms. Current retry count: 5. com.google.protobuf.ServiceException: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hdds.ratis.ServerNotLeaderException): Server:b49fb8c8-35ea-4c3c-9e07-6a74a5029996 is not the leader. Could not determine the leader node. at org.apache.hadoop.hdds.ratis.ServerNotLeaderException.convertToNotLeaderException(ServerNotLeaderException.java:109) at org.apache.hadoop.hdds.scm.ha.RatisUtil.checkRatisException(RatisUtil.java:249) at org.apache.hadoop.hdds.scm.protocol.StorageContainerLocationProtocolServerSideTranslatorPB.submitRequest(StorageContainerLocationProtocolServerSideTranslatorPB.java:199) at org.apache.hadoop.hdds.protocol.proto.StorageContainerLocationProtocolProtos$StorageContainerLocationProtocolService$2.callBlockingMethod(StorageContainerLocationProtocolProtos.java) at org.apache.hadoop.ipc.ProtobufRpcEngine$Server.processCall(ProtobufRpcEngine.java:484) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:595) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:573) at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1213) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1089) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1012) at java.base/java.security.AccessController.doPrivileged(Native Method) at java.base/javax.security.auth.Subject.doAs(Subject.java:423) at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1899) at org.apache.hadoop.ipc.Server$Handler.run(Server.java:3026) , while invoking $Proxy20.submitRequest over nodeId=scm1,nodeAddress=scm1/10.9.0.14:9860 after 6 failover attempts. Trying to failover after sleeping for 2000ms. Current retry count: 6. com.google.protobuf.ServiceException: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hdds.ratis.ServerNotLeaderException): Server:3c6d46e4-d9b6-47ab-9944-2c59eddc2bb8 is not the leader. Could not determine the leader node. at org.apache.hadoop.hdds.ratis.ServerNotLeaderException.convertToNotLeaderException(ServerNotLeaderException.java:109) at org.apache.hadoop.hdds.scm.ha.RatisUtil.checkRatisException(RatisUtil.java:249) at org.apache.hadoop.hdds.scm.protocol.StorageContainerLocationProtocolServerSideTranslatorPB.submitRequest(StorageContainerLocationProtocolServerSideTranslatorPB.java:199) at org.apache.hadoop.hdds.protocol.proto.StorageContainerLocationProtocolProtos$StorageContainerLocationProtocolService$2.callBlockingMethod(StorageContainerLocationProtocolProtos.java) at org.apache.hadoop.ipc.ProtobufRpcEngine$Server.processCall(ProtobufRpcEngine.java:484) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:595) at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:573) at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1213) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1089) at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1012) at java.base/java.security.AccessController.doPrivileged(Native Method) at java.base/javax.security.auth.Subject.doAs(Subject.java:423) at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1899) at org.apache.hadoop.ipc.Server$Handler.run(Server.java:3026) , while invoking $Proxy20.submitRequest over nodeId=scm2,nodeAddress=scm2/10.9.0.15:9860 after 7 failover attempts. Trying to failover after sleeping for 2000ms. Current retry count: 7. com.google.protobuf.ServiceException: java.net.ConnectException: Call From e35c794942b9/10.9.0.14 to scm3:9860 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused, while invoking $Proxy20.submitRequest over nodeId=scm3,nodeAddress=scm3/10.9.0.16:9860 after 8 failover attempts. Trying to failover after sleeping for 2000ms. Current retry count: 8. SCM is in safe mode. validated:false, DataNodeSafeModeRule, registered datanodes (=0) >= required datanodes (=3) validated:false, HealthyPipelineSafeModeRule, healthy Ratis/THREE pipelines (=0) >= healthyPipelineThresholdCount (=1) validated:true, ContainerSafeModeRule, % of containers with at least one reported replica (=1.00) >= safeModeCutoff (=0.99) validated:false, AtleastOneDatanodeReportedRule, reported Ratis/THREE pipelines with at least one datanode (=0) >= threshold (=2)
SECONDS: 95
SCM is out of safe mode.
Safe mode is off
Found OM leader for service omservice: om1 : LEADER (om1)
Replaced OM order with om1,om3,om2 in ha_recon_1
Replaced OM order with om1,om3,om2 in ha_s3g_1
Replaced OM order with om1,om3,om2 in ha_scm1_1
Replaced OM order with om1,om3,om2 in ha_scm2_1
Replaced OM order with om1,om3,om2 in ha_scm3_1
==============================================================================
Finalize :: Finalize Upgrade of the Ozone cluster                             
==============================================================================
Finalize HDDS                                                         | PASS |
------------------------------------------------------------------------------
Finalize OMs                                                          | PASS |
------------------------------------------------------------------------------
Finalize :: Finalize Upgrade of the Ozone cluster                     | PASS |
2 tests, 2 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.4.0-finalized.xml
==============================================================================
Check-Finalization :: Finalize Upgrade of the Ozone cluster                   
==============================================================================
Check OM Finalized                                                    | PASS |
------------------------------------------------------------------------------
Check SCM Finalized                                                   | PASS |
------------------------------------------------------------------------------
Check-Finalization :: Finalize Upgrade of the Ozone cluster           | PASS |
2 tests, 2 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.4.0-finalized-1.xml
==============================================================================
Validate :: Smoketest ozone cluster startup                                   
==============================================================================
Read data from previously created key                                 | PASS |
------------------------------------------------------------------------------
Setup credentials for S3                                              | PASS |
------------------------------------------------------------------------------
Read key created with Ozone Shell using S3 API                        | PASS |
------------------------------------------------------------------------------
Read key created with S3 API using S3 API                             | PASS |
------------------------------------------------------------------------------
Validate :: Smoketest ozone cluster startup                           | PASS |
4 tests, 4 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.4.0-finalized-2.xml
==============================================================================
Validate :: Smoketest ozone cluster startup                                   
==============================================================================
Read data from previously created key                                 | PASS |
------------------------------------------------------------------------------
Setup credentials for S3                                              | PASS |
------------------------------------------------------------------------------
Read key created with Ozone Shell using S3 API                        | PASS |
------------------------------------------------------------------------------
Read key created with S3 API using S3 API                             | PASS |
------------------------------------------------------------------------------
Validate :: Smoketest ozone cluster startup                           | PASS |
4 tests, 4 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.4.0-finalized-3.xml
==============================================================================
Validate :: Smoketest ozone cluster startup                                   
==============================================================================
Read data from previously created key                                 | PASS |
------------------------------------------------------------------------------
Setup credentials for S3                                              | PASS |
------------------------------------------------------------------------------
Read key created with Ozone Shell using S3 API                        | PASS |
------------------------------------------------------------------------------
Read key created with S3 API using S3 API                             | PASS |
------------------------------------------------------------------------------
Validate :: Smoketest ozone cluster startup                           | PASS |
4 tests, 4 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.4.0-finalized-4.xml
==============================================================================
Generate :: Generate data                                                     
==============================================================================
Create a volume and bucket                                            | PASS |
------------------------------------------------------------------------------
Create key                                                            | PASS |
------------------------------------------------------------------------------
Create a bucket in s3v volume                                         | PASS |
------------------------------------------------------------------------------
Create key in the bucket in s3v volume                                | PASS |
------------------------------------------------------------------------------
Setup credentials for S3                                              | PASS |
------------------------------------------------------------------------------
Try to create a bucket using S3 API                                   | PASS |
------------------------------------------------------------------------------
Create key using S3 API                                               | PASS |
------------------------------------------------------------------------------
Generate :: Generate data                                             | PASS |
7 tests, 7 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.4.0-finalized-5.xml
==============================================================================
Validate :: Smoketest ozone cluster startup                                   
==============================================================================
Read data from previously created key                                 | PASS |
------------------------------------------------------------------------------
Setup credentials for S3                                              | PASS |
------------------------------------------------------------------------------
Read key created with Ozone Shell using S3 API                        | PASS |
------------------------------------------------------------------------------
Read key created with S3 API using S3 API                             | PASS |
------------------------------------------------------------------------------
Validate :: Smoketest ozone cluster startup                           | PASS |
4 tests, 4 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.4.0-finalized-6.xml
==============================================================================
Check-Finalization :: Finalize Upgrade of the Ozone cluster                   
==============================================================================
Check OM Finalized                                                    | PASS |
------------------------------------------------------------------------------
Check SCM Finalized                                                   | PASS |
------------------------------------------------------------------------------
Check-Finalization :: Finalize Upgrade of the Ozone cluster           | PASS |
2 tests, 2 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.4.0-finalized-7.xml
==============================================================================
Snapshot-Sh :: Test for using sh commands with snapshots.                     
==============================================================================
Snapshot Creation                                                     | PASS |
------------------------------------------------------------------------------
Snapshot List                                                         | PASS |
------------------------------------------------------------------------------
Snapshot Diff                                                         | PASS |
------------------------------------------------------------------------------
List Snapshot Diff Jobs                                               | PASS |
------------------------------------------------------------------------------
Read Snapshot                                                         | PASS |
------------------------------------------------------------------------------
Delete snapshot                                                       | PASS |
------------------------------------------------------------------------------
Snapshot-Sh :: Test for using sh commands with snapshots.             | PASS |
6 tests, 6 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-1.4.0-finalized-8.xml
Stopping ha_om3_1   ... 
Stopping ha_dn2_1   ... 
Stopping ha_scm3_1  ... 
Stopping ha_dn3_1   ... 
Stopping ha_om2_1   ... 
Stopping ha_recon_1 ... 
Stopping ha_dn1_1   ... 
Stopping ha_dn5_1   ... 
Stopping ha_s3g_1   ... 
Stopping ha_scm2_1  ... 
Stopping ha_scm1_1  ... 
Stopping ha_dn4_1   ... 
Stopping ha_om1_1   ... 
Stopping ha_om1_1   ... done
Stopping ha_om2_1   ... done
Stopping ha_om3_1   ... done
Stopping ha_s3g_1   ... done
Stopping ha_recon_1 ... done
Stopping ha_dn4_1   ... done
Stopping ha_dn1_1   ... done
Stopping ha_dn3_1   ... done
Stopping ha_dn2_1   ... done
Stopping ha_dn5_1   ... done
Stopping ha_scm3_1  ... done
Stopping ha_scm1_1  ... done
Stopping ha_scm2_1  ... done
Removing ha_om3_1   ... 
Removing ha_dn2_1   ... 
Removing ha_scm3_1  ... 
Removing ha_dn3_1   ... 
Removing ha_om2_1   ... 
Removing ha_recon_1 ... 
Removing ha_dn1_1   ... 
Removing ha_dn5_1   ... 
Removing ha_s3g_1   ... 
Removing ha_scm2_1  ... 
Removing ha_scm1_1  ... 
Removing ha_dn4_1   ... 
Removing ha_om1_1   ... 
Removing ha_dn4_1   ... done
Removing ha_recon_1 ... done
Removing ha_scm3_1  ... done
Removing ha_om2_1   ... done
Removing ha_s3g_1   ... done
Removing ha_dn5_1   ... done
Removing ha_dn1_1   ... done
Removing ha_dn3_1   ... done
Removing ha_om1_1   ... done
Removing ha_dn2_1   ... done
Removing ha_scm2_1  ... done
Removing ha_scm1_1  ... done
Removing ha_om3_1   ... done
Removing network ha_net
Log:     /home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/log.html
Report:  /home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/report.html
Output:  /home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/result/1.3.0-1.4.0.xml
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.3.0-downgraded-1.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.3.0-downgraded-2.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.3.0-downgraded-3.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.3.0-downgraded-4.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.3.0-downgraded-5.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.3.0-downgraded-6.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.3.0-downgraded.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.3.0-original-1.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.3.0-original-2.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.3.0-original-3.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.3.0-original.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.4.0-finalized-1.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.4.0-finalized-2.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.4.0-finalized-3.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.4.0-finalized-4.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.4.0-finalized-5.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.4.0-finalized-6.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.4.0-finalized-7.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.4.0-finalized-8.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.4.0-finalized.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.4.0-pre-finalized-1.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.4.0-pre-finalized-2.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.4.0-pre-finalized-3.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.4.0-pre-finalized-4.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.4.0-pre-finalized-5.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.4.0-pre-finalized-6.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/robot-1.4.0-pre-finalized.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/log.html'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/report.html'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/docker-1.3.0-downgraded.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/result/1.3.0-1.4.0/docker-1.3.0-downgraded.log'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/docker-1.3.0-original.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/result/1.3.0-1.4.0/docker-1.3.0-original.log'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/docker-1.4.0-finalized.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/result/1.3.0-1.4.0/docker-1.4.0-finalized.log'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/1.3.0-1.4.0/result/docker-1.4.0-pre-finalized.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/result/1.3.0-1.4.0/docker-1.4.0-pre-finalized.log'
Log:     /home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/result/log.html
Report:  /home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/upgrade/result/report.html
Output:  /home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/result/upgrade.xml
removed 'upgrade/result/1.3.0-1.4.0.xml'
removed 'upgrade/result/log.html'
removed 'upgrade/result/report.html'
renamed 'upgrade/result/1.3.0-1.4.0' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/result/upgrade/1.3.0-1.4.0'
Executing test xcompat/test.sh
Starting cluster with COMPOSE_FILE=new-cluster.yaml:clients.yaml
Removing network xcompat_default
Network xcompat_default not found.
Creating network "xcompat_default" with the default driver
Pulling old_client_1_2_1 (apache/ozone:1.2.1)...
1.2.1: Pulling from apache/ozone
Digest: sha256:1a5f4e28568aaa4aaea6ed560d45b167e0dd8274660e81d746379c2aa6594b7b
Status: Downloaded newer image for apache/ozone:1.2.1
Pulling old_client_1_1_0 (apache/ozone:1.1.0)...
1.1.0: Pulling from apache/ozone
Digest: sha256:6dd13dca7a08ad072b027d30187363bc3552c63947325e871cb51199fbaef172
Status: Downloaded newer image for apache/ozone:1.1.0
Pulling old_client_1_0_0 (apache/ozone:1.0.0)...
received unexpected HTTP status: 503 Service Unavailable
Removing network xcompat_default
ERROR: Test execution of xcompat/test.sh is FAILED!!!!
renamed 'xcompat/result/docker-xcompat.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/result/xcompat/docker-xcompat.log'
Exception in thread "main" Log:     /home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/result/log.html
Report:  /home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-1.4.0-SNAPSHOT/compose/result/report.html
