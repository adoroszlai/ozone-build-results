Using Docker Compose v2
Executing test upgrade/test.sh
Using Docker Compose v2
Using Docker Compose v2
Using docker cluster defined in /home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/compose/ha/docker-compose.yaml
Executing test /home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/./driver.sh
--- RUNNING NON-ROLLING UPGRADE TEST FROM 2.0.0 TO 2.1.0 ---
Using Docker Compose v2
--- SETTING UP OLD VERSION 2.0.0 ---
--- RUNNING WITH OLD VERSION 2.0.0 ---

Port 88 is not available on kdc yet
Port 88 is available on kdc

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet

Port 9860 is not available on scm3 yet
Port 9860 is available on scm3
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 240
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 239
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 238
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 237
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 236
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 235
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 234
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 233
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 232
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 231
SCM is out of safe mode.
Found OM leader for service omservice: om2 : LEADER (om2)
Replaced OM order with om2,om3,om1 in ha-dn1-1
Replaced OM order with om2,om3,om1 in ha-dn2-1
Replaced OM order with om2,om3,om1 in ha-dn3-1
Replaced OM order with om2,om3,om1 in ha-dn4-1
Replaced OM order with om2,om3,om1 in ha-dn5-1
Replaced OM order with om2,om3,om1 in ha-om1-1
Replaced OM order with om2,om3,om1 in ha-om2-1
Replaced OM order with om2,om3,om1 in ha-om3-1
Replaced OM order with om2,om3,om1 in ha-recon-1
Replaced OM order with om2,om3,om1 in ha-s3g-1
Replaced OM order with om2,om3,om1 in ha-scm1-1
Replaced OM order with om2,om3,om1 in ha-scm2-1
Replaced OM order with om2,om3,om1 in ha-scm3-1
Using Docker Compose v2
==============================================================================
2.0.0-2.1.0-1-original-check-finalization :: Finalize Upgrade of the Ozone ...
==============================================================================
Check OM Finalized                                                    | PASS |
------------------------------------------------------------------------------
Check SCM Finalized                                                   | PASS |
------------------------------------------------------------------------------
2.0.0-2.1.0-1-original-check-finalization :: Finalize Upgrade of t... | PASS |
2 tests, 2 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-2.0.0-2.1.0-1-original-001.xml
==============================================================================
2.0.0-2.1.0-1-original-generate-old1 :: Generate data                         
==============================================================================
Create a volume and bucket                                            | PASS |
------------------------------------------------------------------------------
Create key                                                            | PASS |
------------------------------------------------------------------------------
Create a bucket in s3v volume                                         | PASS |
------------------------------------------------------------------------------
Create key in the bucket in s3v volume                                | PASS |
------------------------------------------------------------------------------
Try to create a bucket using S3 API                                   | PASS |
------------------------------------------------------------------------------
Create key using S3 API                                               | PASS |
------------------------------------------------------------------------------
2.0.0-2.1.0-1-original-generate-old1 :: Generate data                 | PASS |
6 tests, 6 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-2.0.0-2.1.0-1-original-002.xml
==============================================================================
2.0.0-2.1.0-1-original-validate-old1 :: Smoketest ozone cluster startup       
==============================================================================
Read data from previously created key                                 | PASS |
------------------------------------------------------------------------------
Read key created with Ozone Shell using S3 API                        | PASS |
------------------------------------------------------------------------------
Read key created with S3 API using S3 API                             | PASS |
------------------------------------------------------------------------------
2.0.0-2.1.0-1-original-validate-old1 :: Smoketest ozone cluster st... | PASS |
3 tests, 3 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-2.0.0-2.1.0-1-original-003.xml
==============================================================================
2.0.0-2.1.0-1-original-prepare :: Prepares OMs                                
==============================================================================
Prepare Ozone Manager                                                 | PASS |
------------------------------------------------------------------------------
2.0.0-2.1.0-1-original-prepare :: Prepares OMs                        | PASS |
1 test, 1 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/upgrade/result/robot-2.0.0-2.1.0-1-original-004.xml
--- RUNNING WITH NEW VERSION 2.1.0 PRE-FINALIZED ---
Error response from daemon: Head "https://ghcr.io/v2/apache/ozone-runner/manifests/20250625-2-jdk21": Get "https://ghcr.io/token?scope=repository%3Aapache%2Fozone-runner%3Apull&service=ghcr.io": net/http: TLS handshake timeout
ERROR: Test execution of /home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/./driver.sh is FAILED!!!!
To use Ozone please mount ozone folder to /opt/hadoop
Output:  /rebot-output/ha-non-rolling-upgrade-2.0.0-2.1.0.xml
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/rebot-4KqyPz/ha-non-rolling-upgrade-2.0.0-2.1.0.xml' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/ha-non-rolling-upgrade-2.0.0-2.1.0.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/ha-non-rolling-upgrade-2.0.0-2.1.0/result/robot-2.0.0-2.1.0-1-original-001.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/ha-non-rolling-upgrade-2.0.0-2.1.0/result/robot-2.0.0-2.1.0-1-original-002.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/ha-non-rolling-upgrade-2.0.0-2.1.0/result/robot-2.0.0-2.1.0-1-original-003.xml'
removed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/ha-non-rolling-upgrade-2.0.0-2.1.0/result/robot-2.0.0-2.1.0-1-original-004.xml'
mkdir: created directory '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/ha-non-rolling-upgrade-2.0.0-2.1.0'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/ha-non-rolling-upgrade-2.0.0-2.1.0/result/docker-2.0.0-2.1.0-1-original-ha-dn1-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/ha-non-rolling-upgrade-2.0.0-2.1.0/docker-2.0.0-2.1.0-1-original-ha-dn1-1.log'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/ha-non-rolling-upgrade-2.0.0-2.1.0/result/docker-2.0.0-2.1.0-1-original-ha-dn2-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/ha-non-rolling-upgrade-2.0.0-2.1.0/docker-2.0.0-2.1.0-1-original-ha-dn2-1.log'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/ha-non-rolling-upgrade-2.0.0-2.1.0/result/docker-2.0.0-2.1.0-1-original-ha-dn3-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/ha-non-rolling-upgrade-2.0.0-2.1.0/docker-2.0.0-2.1.0-1-original-ha-dn3-1.log'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/ha-non-rolling-upgrade-2.0.0-2.1.0/result/docker-2.0.0-2.1.0-1-original-ha-dn4-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/ha-non-rolling-upgrade-2.0.0-2.1.0/docker-2.0.0-2.1.0-1-original-ha-dn4-1.log'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/ha-non-rolling-upgrade-2.0.0-2.1.0/result/docker-2.0.0-2.1.0-1-original-ha-dn5-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/ha-non-rolling-upgrade-2.0.0-2.1.0/docker-2.0.0-2.1.0-1-original-ha-dn5-1.log'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/ha-non-rolling-upgrade-2.0.0-2.1.0/result/docker-2.0.0-2.1.0-1-original-ha-kdc-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/ha-non-rolling-upgrade-2.0.0-2.1.0/docker-2.0.0-2.1.0-1-original-ha-kdc-1.log'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/ha-non-rolling-upgrade-2.0.0-2.1.0/result/docker-2.0.0-2.1.0-1-original-ha-kms-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/ha-non-rolling-upgrade-2.0.0-2.1.0/docker-2.0.0-2.1.0-1-original-ha-kms-1.log'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/ha-non-rolling-upgrade-2.0.0-2.1.0/result/docker-2.0.0-2.1.0-1-original-ha-om1-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/ha-non-rolling-upgrade-2.0.0-2.1.0/docker-2.0.0-2.1.0-1-original-ha-om1-1.log'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/ha-non-rolling-upgrade-2.0.0-2.1.0/result/docker-2.0.0-2.1.0-1-original-ha-om2-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/ha-non-rolling-upgrade-2.0.0-2.1.0/docker-2.0.0-2.1.0-1-original-ha-om2-1.log'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/ha-non-rolling-upgrade-2.0.0-2.1.0/result/docker-2.0.0-2.1.0-1-original-ha-om3-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/ha-non-rolling-upgrade-2.0.0-2.1.0/docker-2.0.0-2.1.0-1-original-ha-om3-1.log'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/ha-non-rolling-upgrade-2.0.0-2.1.0/result/docker-2.0.0-2.1.0-1-original-ha-recon-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/ha-non-rolling-upgrade-2.0.0-2.1.0/docker-2.0.0-2.1.0-1-original-ha-recon-1.log'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/ha-non-rolling-upgrade-2.0.0-2.1.0/result/docker-2.0.0-2.1.0-1-original-ha-s3g-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/ha-non-rolling-upgrade-2.0.0-2.1.0/docker-2.0.0-2.1.0-1-original-ha-s3g-1.log'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/ha-non-rolling-upgrade-2.0.0-2.1.0/result/docker-2.0.0-2.1.0-1-original-ha-scm1-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/ha-non-rolling-upgrade-2.0.0-2.1.0/docker-2.0.0-2.1.0-1-original-ha-scm1-1.log'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/ha-non-rolling-upgrade-2.0.0-2.1.0/result/docker-2.0.0-2.1.0-1-original-ha-scm2-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/ha-non-rolling-upgrade-2.0.0-2.1.0/docker-2.0.0-2.1.0-1-original-ha-scm2-1.log'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/upgrades/non-rolling-upgrade/execution/ha-non-rolling-upgrade-2.0.0-2.1.0/result/docker-2.0.0-2.1.0-1-original-ha-scm3-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/ha-non-rolling-upgrade-2.0.0-2.1.0/docker-2.0.0-2.1.0-1-original-ha-scm3-1.log'
To use Ozone please mount ozone folder to /opt/hadoop
Log:     /rebot-output/log.html
Report:  /rebot-output/report.html
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/rebot-RekIai/log.html' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/log.html'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/rebot-RekIai/report.html' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/upgrade/result/report.html'
ERROR: Test execution of upgrade/test.sh is FAILED!!!!
To use Ozone please mount ozone folder to /opt/hadoop
Output:  /rebot-output/upgrade.xml
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/rebot-96ifBR/upgrade.xml' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/upgrade.xml'
removed 'upgrade/result/ha-non-rolling-upgrade-2.0.0-2.1.0.xml'
removed 'upgrade/result/log.html'
removed 'upgrade/result/report.html'
mkdir: created directory '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/upgrade'
renamed 'upgrade/result/ha-non-rolling-upgrade-2.0.0-2.1.0' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/upgrade/ha-non-rolling-upgrade-2.0.0-2.1.0'
Exception in thread "main" To use Ozone please mount ozone folder to /opt/hadoop
Log:     /rebot-output/log.html
Report:  /rebot-output/report.html
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/rebot-2RUVi3/log.html' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/log.html'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/rebot-2RUVi3/report.html' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/report.html'
removed directory '/tmp/robot-data-TO9xLU'
