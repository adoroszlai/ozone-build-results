Using Docker Compose v2
Executing test ozonesecure/test-certificate-rotation.sh
Using Docker Compose v2
Error response from daemon: Head "https://ghcr.io/v2/apache/ozone-runner/manifests/20250625-2-jdk21": dial tcp 140.82.116.34:443: i/o timeout
ERROR: Test execution of ozonesecure/test-certificate-rotation.sh is FAILED!!!!
mkdir: created directory '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/ozonesecure'
mkdir: created directory '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/ozonesecure/certificate-rotation'
mv: cannot stat 'ozonesecure/result/*': No such file or directory
Executing test ozonesecure/test-root-ca-rotation.sh
Using Docker Compose v2
Port 88 is available on kdc
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is available on scm
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 236
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 235
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 234
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 233
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 232
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 231
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 230
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 229
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 228
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 227
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 226
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 225
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 224
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 223
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 222
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 221
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 220
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 219
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 218
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 217
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 216
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 215
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 214
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 213
SCM is out of safe mode.
No OM HA service, no need to wait
key1 has been successfully created with options Options{cipher='AES/CTR/NoPadding', bitLength=128, description='null', attributes=null}.
org.apache.hadoop.crypto.key.kms.LoadBalancingKMSClientProvider@539d019 has been updated.
==============================================================================
Kinit :: Kinit test user                                                      
==============================================================================
Kinit                                                                 | PASS |
------------------------------------------------------------------------------
Kinit :: Kinit test user                                              | PASS |
1 test, 1 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/ozonesecure/result/robot-001.xml
"RootCARotationManager-Active" #411 [770] daemon prio=5 os_prio=0 cpu=4.98ms elapsed=34.23s tid=0x00007fed86ecab40 nid=770 waiting on condition  [0x00007fecf4eed000]
jps | grep StorageContainerManagerStarter |  sed 's/StorageContainerManagerStarter//' | xargs | xargs -I {} jstack {} | grep 'RootCARotationManager-Active' succeed
2 root certificates are not found yet
2 root certificates are not found yet
2 root certificates are not found yet
2 root certificates are not found yet
2 root certificates are not found yet
2 root certificates are not found yet
2 root certificates are not found yet
2 root certificates are not found yet
2 root certificates are not found yet
2 root certificates are not found yet
2 root certificates are not found yet
2 root certificates are found
==============================================================================
Kinit :: Kinit test user                                                      
==============================================================================
Kinit                                                                 | PASS |
------------------------------------------------------------------------------
Kinit :: Kinit test user                                              | PASS |
1 test, 1 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/ozonesecure/result/robot-002.xml
/data/metadata/dn/certs/ROOTCA-24.crt
ozone admin cert list --role=scm | grep -v 'scm-sub' | grep 'scm' | cut -d ' ' -f 1 | sort | tail -n 1 | xargs -I {} echo /data/metadata/dn/certs/ROOTCA-{}.crt | xargs find succeed
==============================================================================
Kinit :: Kinit test user                                                      
==============================================================================
Kinit                                                                 | PASS |
------------------------------------------------------------------------------
Kinit :: Kinit test user                                              | PASS |
1 test, 1 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/ozonesecure/result/robot-003.xml
/data/metadata/om/certs/ROOTCA-24.crt
ozone admin cert list --role=scm | grep -v 'scm-sub' | grep 'scm' | cut -d ' ' -f 1 | sort | tail -n 1 | xargs -I {} echo /data/metadata/om/certs/ROOTCA-{}.crt | xargs find succeed
==============================================================================
Root-Ca-Rotation-Client-Checks :: Generate data                               
==============================================================================
Create a volume and bucket                                            | PASS |
------------------------------------------------------------------------------
Create key                                                            | PASS |
------------------------------------------------------------------------------
Read data from previously created key                                 | PASS |
------------------------------------------------------------------------------
Root-Ca-Rotation-Client-Checks :: Generate data                       | PASS |
3 tests, 3 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/ozonesecure/result/robot-004.xml
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are found
/data/metadata/om/certs/ROOTCA-56.crt
ozone admin cert list --role=scm | grep -v 'scm-sub' | grep 'scm' | cut -d ' ' -f 1 | sort | tail -n 1 | xargs -I {} echo /data/metadata/om/certs/ROOTCA-{}.crt | xargs find succeed
Certificate id: 1
  [0]         Version: 3
         SerialNumber: 1
             IssuerDN: CN=scm@scm,OU=ca460cac-7b5c-403c-a74d-3ed77914b2cd,O=CID-914d2bb5-5435-43ff-9d55-46ceb0440c70,SERIALNUMBER=1
           Start Date: Thu Dec 18 16:54:22 UTC 2025
           Final Date: Thu Dec 18 16:57:22 UTC 2025
            SubjectDN: CN=scm@scm,OU=ca460cac-7b5c-403c-a74d-3ed77914b2cd,O=CID-914d2bb5-5435-43ff-9d55-46ceb0440c70,SERIALNUMBER=1
           Public Key: RSA Public Key [73:bd:e2:77:0f:57:5f:d3:13:b8:28:7c:aa:05:24:15:3b:9f:1b:d4],[56:66:d1:a4]
        modulus: b8aba0fb0696cdc9a373f0bd7c819a1cc80bb117fe2e04810131eb00d618e1ae32d26abeae4a6402e63117f3decfb028f49fcb1004e43c2c31608342653f7df2447dfba0157c1cf4226f20259d6d8e05d43eed58e056f6f4c5e7c4a156baa643a5015ec8cd5af0d17eca6f529f4442b78e112f9489d53f04a6a8274d0dfbc5b03d2918779e86d1626c1829c8fb0b2a8c8a5e5fd8e7b63b856f308d70564c399f7dca9f5821a8f68ef8af71d4400b7d8cd0a3c2e715555b19c438b2b274df02ba8c39275ce7ac6b8d6c4915fd674aa3514393dd758a11867a77fef7c10ddb02a21031231a776586cb7136242d1b22a29d9f80fac3416d05490fbbff9abb018eab
public exponent: 10001

  Signature Algorithm: SHA256WITHRSA
            Signature: b05c97a46c1c87dd6ea6f56f856a5b4bd36995a1
                       c337096689f520f45e22aff1846a3ddb7ced7389
                       bae49d5602af9b65048f6b02ef779d84deede61f
                       ee0253608b41541ce135f47c61115f16235b32f1
                       7178e52cf389db3c46a0a59aa2d3b5c63c8f4f34
                       36f796dad6f63c10693e3db2b57e1f5bd98489c0
                       3924e6e2b64f8fb9a417e8afed7c967860fd23b6
                       2911ff00f56229eea1516fa4aa0664ee1d69eddd
                       eda7762018adcb666d749ab2307e0d7479c0a4a4
                       0ad77d05b53893f3a626f024a0d0337ad8437303
                       cc52254a5c09cf0207498a53b0b4848c14e739ba
                       73ee9d79f2df82c5fa27134b63287e50415ac8f4
                       8be3cdc29baa4531a9d45edeb257d183
       Extensions: 
                       critical(true) BasicConstraints: isCa(true)
                       critical(true) KeyUsage: 0x6
                       critical(false) 2.5.29.17 value = Sequence
    Tagged [CONTEXT 7] IMPLICIT
        DER Octet String[4]


! ozone admin cert info 1 hasn't succeed yet
Certificate id: 1
  [0]         Version: 3
         SerialNumber: 1
             IssuerDN: CN=scm@scm,OU=ca460cac-7b5c-403c-a74d-3ed77914b2cd,O=CID-914d2bb5-5435-43ff-9d55-46ceb0440c70,SERIALNUMBER=1
           Start Date: Thu Dec 18 16:54:22 UTC 2025
           Final Date: Thu Dec 18 16:57:22 UTC 2025
            SubjectDN: CN=scm@scm,OU=ca460cac-7b5c-403c-a74d-3ed77914b2cd,O=CID-914d2bb5-5435-43ff-9d55-46ceb0440c70,SERIALNUMBER=1
           Public Key: RSA Public Key [73:bd:e2:77:0f:57:5f:d3:13:b8:28:7c:aa:05:24:15:3b:9f:1b:d4],[56:66:d1:a4]
        modulus: b8aba0fb0696cdc9a373f0bd7c819a1cc80bb117fe2e04810131eb00d618e1ae32d26abeae4a6402e63117f3decfb028f49fcb1004e43c2c31608342653f7df2447dfba0157c1cf4226f20259d6d8e05d43eed58e056f6f4c5e7c4a156baa643a5015ec8cd5af0d17eca6f529f4442b78e112f9489d53f04a6a8274d0dfbc5b03d2918779e86d1626c1829c8fb0b2a8c8a5e5fd8e7b63b856f308d70564c399f7dca9f5821a8f68ef8af71d4400b7d8cd0a3c2e715555b19c438b2b274df02ba8c39275ce7ac6b8d6c4915fd674aa3514393dd758a11867a77fef7c10ddb02a21031231a776586cb7136242d1b22a29d9f80fac3416d05490fbbff9abb018eab
public exponent: 10001

  Signature Algorithm: SHA256WITHRSA
            Signature: b05c97a46c1c87dd6ea6f56f856a5b4bd36995a1
                       c337096689f520f45e22aff1846a3ddb7ced7389
                       bae49d5602af9b65048f6b02ef779d84deede61f
                       ee0253608b41541ce135f47c61115f16235b32f1
                       7178e52cf389db3c46a0a59aa2d3b5c63c8f4f34
                       36f796dad6f63c10693e3db2b57e1f5bd98489c0
                       3924e6e2b64f8fb9a417e8afed7c967860fd23b6
                       2911ff00f56229eea1516fa4aa0664ee1d69eddd
                       eda7762018adcb666d749ab2307e0d7479c0a4a4
                       0ad77d05b53893f3a626f024a0d0337ad8437303
                       cc52254a5c09cf0207498a53b0b4848c14e739ba
                       73ee9d79f2df82c5fa27134b63287e50415ac8f4
                       8be3cdc29baa4531a9d45edeb257d183
       Extensions: 
                       critical(true) BasicConstraints: isCa(true)
                       critical(true) KeyUsage: 0x6
                       critical(false) 2.5.29.17 value = Sequence
    Tagged [CONTEXT 7] IMPLICIT
        DER Octet String[4]


! ozone admin cert info 1 hasn't succeed yet
Certificate not found
! ozone admin cert info 1 succeed
==============================================================================
Root-Ca-Rotation-Client-Checks :: Generate data                               
==============================================================================
Create a volume and bucket                                            | PASS |
------------------------------------------------------------------------------
Create key                                                            | PASS |
------------------------------------------------------------------------------
Read data from previously created key                                 | PASS |
------------------------------------------------------------------------------
Root-Ca-Rotation-Client-Checks :: Generate data                       | PASS |
3 tests, 3 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/ozonesecure/result/robot-005.xml
==============================================================================
Root-Ca-Rotation :: Smoketest ozone cluster startup                           
==============================================================================
Verify root CA rotation metrics                                       | PASS |
------------------------------------------------------------------------------
Root-Ca-Rotation :: Smoketest ozone cluster startup                   | PASS |
1 test, 1 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/ozonesecure/result/robot-006.xml
To use Ozone please mount ozone folder to /opt/hadoop
Log:     /rebot-output/log.html
Report:  /rebot-output/report.html
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/ozonesecure/result/rebot-uVtmuD/log.html' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/ozonesecure/result/log.html'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/ozonesecure/result/rebot-uVtmuD/report.html' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/ozonesecure/result/report.html'
To use Ozone please mount ozone folder to /opt/hadoop
Output:  /rebot-output/ozonesecure-root-ca-rotation.xml
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/rebot-hW7KVN/ozonesecure-root-ca-rotation.xml' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/ozonesecure-root-ca-rotation.xml'
removed 'ozonesecure/result/robot-001.xml'
removed 'ozonesecure/result/robot-002.xml'
removed 'ozonesecure/result/robot-003.xml'
removed 'ozonesecure/result/robot-004.xml'
removed 'ozonesecure/result/robot-005.xml'
removed 'ozonesecure/result/robot-006.xml'
removed 'ozonesecure/result/log.html'
removed 'ozonesecure/result/report.html'
mkdir: created directory '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation'
renamed 'ozonesecure/result/dn-audit-dn.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/dn-audit-dn.log'
renamed 'ozonesecure/result/docker-ozonesecure-datanode-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/docker-ozonesecure-datanode-1.log'
renamed 'ozonesecure/result/docker-ozonesecure-datanode-2.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/docker-ozonesecure-datanode-2.log'
renamed 'ozonesecure/result/docker-ozonesecure-datanode-3.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/docker-ozonesecure-datanode-3.log'
renamed 'ozonesecure/result/docker-ozonesecure-httpfs-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/docker-ozonesecure-httpfs-1.log'
renamed 'ozonesecure/result/docker-ozonesecure-kdc-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/docker-ozonesecure-kdc-1.log'
renamed 'ozonesecure/result/docker-ozonesecure-kms-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/docker-ozonesecure-kms-1.log'
renamed 'ozonesecure/result/docker-ozonesecure-om-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/docker-ozonesecure-om-1.log'
renamed 'ozonesecure/result/docker-ozonesecure-recon-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/docker-ozonesecure-recon-1.log'
renamed 'ozonesecure/result/docker-ozonesecure-s3g-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/docker-ozonesecure-s3g-1.log'
renamed 'ozonesecure/result/docker-ozonesecure-scm-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/docker-ozonesecure-scm-1.log'
renamed 'ozonesecure/result/kms-audit.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/kms-audit.log'
renamed 'ozonesecure/result/om-audit-om.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/om-audit-om.log'
renamed 'ozonesecure/result/om-sys-audit-om.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/om-sys-audit-om.log'
renamed 'ozonesecure/result/s3g-audit-s3g.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/s3g-audit-s3g.log'
renamed 'ozonesecure/result/scm-audit-scm.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/scm-audit-scm.log'
To use Ozone please mount ozone folder to /opt/hadoop
Log:     /rebot-output/log.html
Report:  /rebot-output/report.html
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/rebot-Fyd9vL/log.html' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/log.html'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/rebot-Fyd9vL/report.html' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.2.0-SNAPSHOT/compose/result/report.html'
removed directory '/tmp/robot-data-Ybqx3d'
