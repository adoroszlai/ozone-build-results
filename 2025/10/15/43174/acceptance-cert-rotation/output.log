Using Docker Compose v2
Executing test ozonesecure/test-certificate-rotation.sh
Using Docker Compose v2
Error response from daemon: Head "https://ghcr.io/v2/apache/ozone-testkrb5/manifests/20241129-1": Get "https://ghcr.io/token?scope=repository%3Aapache%2Fozone-testkrb5%3Apull&service=ghcr.io": net/http: request canceled (Client.Timeout exceeded while awaiting headers)
ERROR: Test execution of ozonesecure/test-certificate-rotation.sh is FAILED!!!!
mkdir: created directory '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/ozonesecure'
mkdir: created directory '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/ozonesecure/certificate-rotation'
mv: cannot stat 'ozonesecure/result/*': No such file or directory
Executing test ozonesecure/test-root-ca-rotation.sh
Using Docker Compose v2
Port 88 is available on kdc
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is not available on scm yet
Port 9860 is available on scm
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 236
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 235
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 234
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 233
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 232
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 231
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 230
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 229
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 228
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 227
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 226
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 225
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 224
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 223
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 222
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 221
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 220
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 219
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 218
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 217
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 216
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 215
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 214
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 213
SCM is in safe mode. Will retry in 1 sec. Remaining time (sec): 212
SCM is out of safe mode.
No OM HA service, no need to wait
key1 has been successfully created with options Options{cipher='AES/CTR/NoPadding', bitLength=128, description='null', attributes=null}.
org.apache.hadoop.crypto.key.kms.LoadBalancingKMSClientProvider@7749bf93 has been updated.
==============================================================================
Kinit :: Kinit test user                                                      
==============================================================================
Kinit                                                                 | PASS |
------------------------------------------------------------------------------
Kinit :: Kinit test user                                              | PASS |
1 test, 1 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/ozonesecure/result/robot-001.xml
"RootCARotationManager-Active" #317 [677] daemon prio=5 os_prio=0 cpu=5.47ms elapsed=35.59s tid=0x00007fadcef14d40 nid=677 waiting on condition  [0x00007fad425e1000]
jps | grep StorageContainerManagerStarter |  sed 's/StorageContainerManagerStarter//' | xargs | xargs -I {} jstack {} | grep 'RootCARotationManager-Active' succeed
2 root certificates are not found yet
2 root certificates are not found yet
2 root certificates are not found yet
2 root certificates are not found yet
2 root certificates are not found yet
2 root certificates are not found yet
2 root certificates are not found yet
2 root certificates are not found yet
2 root certificates are not found yet
2 root certificates are not found yet
2 root certificates are not found yet
2 root certificates are found
==============================================================================
Kinit :: Kinit test user                                                      
==============================================================================
Kinit                                                                 | PASS |
------------------------------------------------------------------------------
Kinit :: Kinit test user                                              | PASS |
1 test, 1 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/ozonesecure/result/robot-002.xml
/data/metadata/dn/certs/ROOTCA-24.crt
ozone admin cert list --role=scm | grep -v 'scm-sub' | grep 'scm' | cut -d ' ' -f 1 | sort | tail -n 1 | xargs -I {} echo /data/metadata/dn/certs/ROOTCA-{}.crt | xargs find succeed
==============================================================================
Kinit :: Kinit test user                                                      
==============================================================================
Kinit                                                                 | PASS |
------------------------------------------------------------------------------
Kinit :: Kinit test user                                              | PASS |
1 test, 1 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/ozonesecure/result/robot-003.xml
/data/metadata/om/certs/ROOTCA-24.crt
ozone admin cert list --role=scm | grep -v 'scm-sub' | grep 'scm' | cut -d ' ' -f 1 | sort | tail -n 1 | xargs -I {} echo /data/metadata/om/certs/ROOTCA-{}.crt | xargs find succeed
==============================================================================
Root-Ca-Rotation-Client-Checks :: Generate data                               
==============================================================================
Create a volume and bucket                                            | PASS |
------------------------------------------------------------------------------
Create key                                                            | PASS |
------------------------------------------------------------------------------
Read data from previously created key                                 | PASS |
------------------------------------------------------------------------------
Root-Ca-Rotation-Client-Checks :: Generate data                       | PASS |
3 tests, 3 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/ozonesecure/result/robot-004.xml
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are not found yet
3 root certificates are found
/data/metadata/om/certs/ROOTCA-56.crt
ozone admin cert list --role=scm | grep -v 'scm-sub' | grep 'scm' | cut -d ' ' -f 1 | sort | tail -n 1 | xargs -I {} echo /data/metadata/om/certs/ROOTCA-{}.crt | xargs find succeed
Certificate id: 1
  [0]         Version: 3
         SerialNumber: 1
             IssuerDN: CN=scm@scm,OU=2fc5f41d-295f-41fd-ad42-8df4706c20fe,O=CID-dab9e9e3-3def-479c-be92-a6bf2808deb7,SERIALNUMBER=1
           Start Date: Wed Oct 15 14:37:48 UTC 2025
           Final Date: Wed Oct 15 14:40:48 UTC 2025
            SubjectDN: CN=scm@scm,OU=2fc5f41d-295f-41fd-ad42-8df4706c20fe,O=CID-dab9e9e3-3def-479c-be92-a6bf2808deb7,SERIALNUMBER=1
           Public Key: RSA Public Key [92:d8:bf:d1:fa:d1:fc:02:8a:15:1d:ab:63:35:30:fc:49:e0:fd:ae],[56:66:d1:a4]
        modulus: ce0ce2d43f8abbd2335a9ee7b40cbbbcc76034e4366a9c3a072c6636976aa12019c3eca1d879b3b176225e54bcc6bd52c96e746042698be80e6af4c4013d3c84c8184a0a329c09e9d8ee23f1c720734f6335ee5ad9caad8a632b14c5936cf913925c41257355b8ea77d50f3cd255b00641e2953baeb664c43d7bfd76f9ed7067ca1e3c9a46817421756af6d31526a4b38be3ee52d673ee64669100554c21661cbf6c85a8e5489f568227f956aa1bf4e78f2c5e72c2ed60abbe62efadea58c8198d4f8598a4690ce6d707bf0159bf754c8ee39f5cab25bf4715266ce4dd3fb43c05fa05ff6db8e7d15e903e9c72e70965b9816bf88db957097504362493f7bfe5
public exponent: 10001

  Signature Algorithm: SHA256WITHRSA
            Signature: 92d3af391a1cf256879b06f4c52b98420d79d8de
                       4c286316db040d5c2696c8f97968d3920301e74c
                       e727e8bee82a504f9a1b5183c1a29b34dbb0ebfb
                       02f6943e3890fa977d28fa7f454103bb856f83a0
                       8e181aeea93d776c658f94bf00e8f02cc3e7bba6
                       1c348196da1705f98082c4c1d7558eb933a23d68
                       5a78b11cecafb1478db11fee9f17beca75dec27b
                       9af14ec7cf68f39e330cc465cff62ab74f59349f
                       a0e68520b9a7628fccba80c3fed1d4f6d7b64b93
                       b9b453b9996c9f724208b118d846789674a94158
                       e274bdd86db956b7209be9a8666e9db0dce4d7a4
                       4b77474c53cec06c246a68eb52ae29dc37519f99
                       f37bcdf5bd6a1df0be08fce25b071c58
       Extensions: 
                       critical(true) BasicConstraints: isCa(true)
                       critical(true) KeyUsage: 0x6
                       critical(false) 2.5.29.17 value = Sequence
    Tagged [CONTEXT 7] IMPLICIT
        DER Octet String[4]


! ozone admin cert info 1 hasn't succeed yet
Certificate id: 1
  [0]         Version: 3
         SerialNumber: 1
             IssuerDN: CN=scm@scm,OU=2fc5f41d-295f-41fd-ad42-8df4706c20fe,O=CID-dab9e9e3-3def-479c-be92-a6bf2808deb7,SERIALNUMBER=1
           Start Date: Wed Oct 15 14:37:48 UTC 2025
           Final Date: Wed Oct 15 14:40:48 UTC 2025
            SubjectDN: CN=scm@scm,OU=2fc5f41d-295f-41fd-ad42-8df4706c20fe,O=CID-dab9e9e3-3def-479c-be92-a6bf2808deb7,SERIALNUMBER=1
           Public Key: RSA Public Key [92:d8:bf:d1:fa:d1:fc:02:8a:15:1d:ab:63:35:30:fc:49:e0:fd:ae],[56:66:d1:a4]
        modulus: ce0ce2d43f8abbd2335a9ee7b40cbbbcc76034e4366a9c3a072c6636976aa12019c3eca1d879b3b176225e54bcc6bd52c96e746042698be80e6af4c4013d3c84c8184a0a329c09e9d8ee23f1c720734f6335ee5ad9caad8a632b14c5936cf913925c41257355b8ea77d50f3cd255b00641e2953baeb664c43d7bfd76f9ed7067ca1e3c9a46817421756af6d31526a4b38be3ee52d673ee64669100554c21661cbf6c85a8e5489f568227f956aa1bf4e78f2c5e72c2ed60abbe62efadea58c8198d4f8598a4690ce6d707bf0159bf754c8ee39f5cab25bf4715266ce4dd3fb43c05fa05ff6db8e7d15e903e9c72e70965b9816bf88db957097504362493f7bfe5
public exponent: 10001

  Signature Algorithm: SHA256WITHRSA
            Signature: 92d3af391a1cf256879b06f4c52b98420d79d8de
                       4c286316db040d5c2696c8f97968d3920301e74c
                       e727e8bee82a504f9a1b5183c1a29b34dbb0ebfb
                       02f6943e3890fa977d28fa7f454103bb856f83a0
                       8e181aeea93d776c658f94bf00e8f02cc3e7bba6
                       1c348196da1705f98082c4c1d7558eb933a23d68
                       5a78b11cecafb1478db11fee9f17beca75dec27b
                       9af14ec7cf68f39e330cc465cff62ab74f59349f
                       a0e68520b9a7628fccba80c3fed1d4f6d7b64b93
                       b9b453b9996c9f724208b118d846789674a94158
                       e274bdd86db956b7209be9a8666e9db0dce4d7a4
                       4b77474c53cec06c246a68eb52ae29dc37519f99
                       f37bcdf5bd6a1df0be08fce25b071c58
       Extensions: 
                       critical(true) BasicConstraints: isCa(true)
                       critical(true) KeyUsage: 0x6
                       critical(false) 2.5.29.17 value = Sequence
    Tagged [CONTEXT 7] IMPLICIT
        DER Octet String[4]


! ozone admin cert info 1 hasn't succeed yet
Certificate not found
! ozone admin cert info 1 succeed
==============================================================================
Root-Ca-Rotation-Client-Checks :: Generate data                               
==============================================================================
Create a volume and bucket                                            | PASS |
------------------------------------------------------------------------------
Create key                                                            | PASS |
------------------------------------------------------------------------------
Read data from previously created key                                 | PASS |
------------------------------------------------------------------------------
Root-Ca-Rotation-Client-Checks :: Generate data                       | PASS |
3 tests, 3 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/ozonesecure/result/robot-005.xml
==============================================================================
Root-Ca-Rotation :: Smoketest ozone cluster startup                           
==============================================================================
Verify root CA rotation metrics                                       | PASS |
------------------------------------------------------------------------------
Root-Ca-Rotation :: Smoketest ozone cluster startup                   | PASS |
1 test, 1 passed, 0 failed
==============================================================================
Output:  /tmp/smoketest/ozonesecure/result/robot-006.xml
To use Ozone please mount ozone folder to /opt/hadoop
Log:     /rebot-output/log.html
Report:  /rebot-output/report.html
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/ozonesecure/result/rebot-tvk0Tw/log.html' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/ozonesecure/result/log.html'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/ozonesecure/result/rebot-tvk0Tw/report.html' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/ozonesecure/result/report.html'
To use Ozone please mount ozone folder to /opt/hadoop
Output:  /rebot-output/ozonesecure-root-ca-rotation.xml
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/rebot-mftXEm/ozonesecure-root-ca-rotation.xml' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/ozonesecure-root-ca-rotation.xml'
removed 'ozonesecure/result/robot-001.xml'
removed 'ozonesecure/result/robot-002.xml'
removed 'ozonesecure/result/robot-003.xml'
removed 'ozonesecure/result/robot-004.xml'
removed 'ozonesecure/result/robot-005.xml'
removed 'ozonesecure/result/robot-006.xml'
removed 'ozonesecure/result/log.html'
removed 'ozonesecure/result/report.html'
mkdir: created directory '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation'
renamed 'ozonesecure/result/dn-audit-dn.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/dn-audit-dn.log'
renamed 'ozonesecure/result/docker-ozonesecure-datanode-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/docker-ozonesecure-datanode-1.log'
renamed 'ozonesecure/result/docker-ozonesecure-datanode-2.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/docker-ozonesecure-datanode-2.log'
renamed 'ozonesecure/result/docker-ozonesecure-datanode-3.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/docker-ozonesecure-datanode-3.log'
renamed 'ozonesecure/result/docker-ozonesecure-httpfs-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/docker-ozonesecure-httpfs-1.log'
renamed 'ozonesecure/result/docker-ozonesecure-kdc-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/docker-ozonesecure-kdc-1.log'
renamed 'ozonesecure/result/docker-ozonesecure-kms-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/docker-ozonesecure-kms-1.log'
renamed 'ozonesecure/result/docker-ozonesecure-om-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/docker-ozonesecure-om-1.log'
renamed 'ozonesecure/result/docker-ozonesecure-recon-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/docker-ozonesecure-recon-1.log'
renamed 'ozonesecure/result/docker-ozonesecure-s3g-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/docker-ozonesecure-s3g-1.log'
renamed 'ozonesecure/result/docker-ozonesecure-scm-1.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/docker-ozonesecure-scm-1.log'
renamed 'ozonesecure/result/kms-audit.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/kms-audit.log'
renamed 'ozonesecure/result/om-audit-om.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/om-audit-om.log'
renamed 'ozonesecure/result/om-sys-audit-om.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/om-sys-audit-om.log'
renamed 'ozonesecure/result/s3g-audit-s3g.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/s3g-audit-s3g.log'
renamed 'ozonesecure/result/scm-audit-scm.log' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/ozonesecure/root-ca-rotation/scm-audit-scm.log'
To use Ozone please mount ozone folder to /opt/hadoop
Log:     /rebot-output/log.html
Report:  /rebot-output/report.html
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/rebot-nlk4cW/log.html' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/log.html'
renamed '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/rebot-nlk4cW/report.html' -> '/home/runner/work/ozone/ozone/hadoop-ozone/dist/target/ozone-2.1.0-SNAPSHOT/compose/result/report.html'
removed directory '/tmp/robot-data-d0yEZv'
